<?xml version="1.0" encoding="UTF-8"?>
<!-- -*- nxml -*- -->
<transfer>
  <section-def-cats>
    <def-cat n="nom">
      <cat-item tags="n.*"/>
    </def-cat>
    <def-cat n="npant">
      <cat-item tags="np.ant"/>
    </def-cat>
    <def-cat n="nploc">
      <cat-item tags="np.loc"/>
    </def-cat>
    <def-cat n="det">
      <cat-item tags="det.*"/>
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="cada">
      <cat-item lemma="cada" tags="det.*"/>
    </def-cat>
    <def-cat n="detdef">
      <cat-item tags="det.def.*"/>
    </def-cat>
    <def-cat n="predet">
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="adjec">
      <cat-item tags="adj.*"/>
      <cat-item tags="vblex.pp.*"/>
    </def-cat>
    <def-cat n="adj">
      <cat-item tags="adj.*"/>
    </def-cat>
   <def-cat n="adv">
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
    </def-cat>
    <def-cat n="noadv">
      <cat-item lemma="no" tags="adv"/>
    </def-cat>
    <def-cat n="negadv"> <!-- adverbis negatius que segueixen un no: no canta pas, mai, enlloc -->
      <cat-item lemma="pas" tags="adv"/>
      <cat-item lemma="mai" tags="adv"/>
      <cat-item lemma="enlloc" tags="adv"/>
      <cat-item lemma="gens" tags="adv"/>
      <cat-item lemma="gens ni mica" tags="adv"/>
      <cat-item lemma="de cap manera" tags="adv"/>
      <cat-item lemma="gaire" tags="adv"/>
    </def-cat>
    <def-cat n="prep">
      <cat-item tags="pr"/>
    </def-cat>
    <def-cat n="deprep">
      <cat-item lemma="de" tags="pr"/>
    </def-cat>
    <def-cat n="que">
      <cat-item lemma="que" tags="cnjsub"/>
    </def-cat>
    <def-cat n="com">
      <cat-item lemma="com" tags="pr"/>
      <cat-item lemma="com" tags="rel.adv"/>
    </def-cat>
    <def-cat n="quecom">
      <cat-item lemma="que" tags="cnjsub"/>
      <cat-item lemma="que" tags="rel.*"/>
      <cat-item lemma="com" tags="pr"/>
      <cat-item lemma="com" tags="rel.adv"/>
    </def-cat>
    <def-cat n="relat">
      <cat-item tags="rel.*"/>
    </def-cat>
    <def-cat n="prn">
      <cat-item tags="prn.tn.*"/>
      <cat-item tags="prn.itg.*"/>
    </def-cat>
    <def-cat n="prntn">
      <cat-item tags="prn.tn.*"/>
    </def-cat>
    <def-cat n="prnenc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>
    <def-cat n="prnpro">
      <cat-item tags="prn.pro.*"/>
    </def-cat>
    <def-cat n="prnproref">
      <cat-item lemma="em" tags="prn.pro.p1.mf.sg"/>
      <cat-item lemma="et" tags="prn.pro.p2.mf.sg"/>
      <cat-item lemma="es" tags="prn.pro.ref.p3.mf.sp"/>
      <cat-item lemma="ens" tags="prn.pro.p1.mf.pl"/>
      <cat-item lemma="us" tags="prn.pro.p2.mf.pl"/>
    </def-cat>
    <def-cat n="es">
      <cat-item lemma="es" tags="prn.pro.ref.p3.mf.sp"/>
    </def-cat>
    <def-cat n="tu">
      <cat-item lemma="tu" tags="prn.tn.*"/>
    </def-cat>
    <def-cat n="ell">
      <cat-item lemma="ell" tags="prn.tn.p3.m.sg"/>
    </def-cat>
    <def-cat n="ells">
      <cat-item lemma="ell" tags="prn.tn.p3.m.pl"/>
    </def-cat>
    <def-cat n="vbser">
      <cat-item tags="vbser.*"/>
    </def-cat>
    <def-cat n="verb_conj">
      <cat-item tags="vblex.*.p1.*"/>
      <cat-item tags="vblex.*.p2.*"/>
      <cat-item tags="vblex.*.p3.*"/>
      <cat-item tags="vbser.*.p1.*"/>
      <cat-item tags="vbser.*.p2.*"/>
      <cat-item tags="vbser.*.p3.*"/>
      <cat-item tags="vbhaver.*.p1.*"/>
      <cat-item tags="vbhaver.*.p2.*"/>
      <cat-item tags="vbhaver.*.p3.*"/>
      <cat-item tags="vbmod.*.p1.*"/>
      <cat-item tags="vbmod.*.p2.*"/>
      <cat-item tags="vbmod.*.p3.*"/>
    </def-cat>
    <def-cat n="verbnp">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbhaver.ger"/>
      <cat-item tags="vbhaver.pp.*"/>
      <cat-item tags="vbmod.inf"/>
      <cat-item tags="vbmod.ger"/>
      <cat-item tags="vbmod.pp.*"/>
    </def-cat>
    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbmod.inf"/>
    </def-cat>
    <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbhaver.ger"/>
      <cat-item tags="vbmod.ger"/>
    </def-cat>
    <def-cat n="imp">
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbhaver.imp.*"/>
      <cat-item tags="vbmod.imp.*"/>
    </def-cat>
    <def-cat n="infnm">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbhaver.inf"/>
    </def-cat>
    <def-cat n="infnh">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbmod.inf"/>
    </def-cat>
    <def-cat n="pp">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbhaver.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
    </def-cat>
    <def-cat n="ppf">
      <cat-item tags="vblex.pp.f.sg"/>
      <cat-item tags="vbhaver.pp.f.sg"/>
      <cat-item tags="vbmod.pp.f.sg"/>
    </def-cat>
    <def-cat n="haver-tmp-srd-cnj-p3">	<!-- verb amb els temps verbals conjugats (amb persona) del sard -->
      <cat-item lemma="haver" tags="vbhaver.pri.p3.*"/>
      <cat-item lemma="haver" tags="vbhaver.prs.p3.*"/>
      <cat-item lemma="haver" tags="vbhaver.pii.p3.*"/>
      <cat-item lemma="haver" tags="vbhaver.pis.p3.*"/>
      <cat-item lemma="haver" tags="vbhaver.cni.p3.*"/>
      <cat-item lemma="haver" tags="vbhaver.ifi.p3.*"/>
      <cat-item lemma="haver" tags="vbhaver.fti.p3.*"/>
      <cat-item lemma="haver" tags="vbhaver.imp.p3.*"/>
    </def-cat>
    <def-cat n="num">
      <cat-item tags="num.*"/>
      <cat-item tags="num"/>
    </def-cat>
    <def-cat n="xifra">
      <cat-item tags="num"/>
    </def-cat>
    <def-cat n="mes">
      <cat-item lemma="gener" tags="n.*"/>
      <cat-item lemma="febrer" tags="n.*"/>
      <cat-item lemma="març" tags="n.*"/>
      <cat-item lemma="abril" tags="n.*"/>
      <cat-item lemma="maig" tags="n.*"/>
      <cat-item lemma="juny" tags="n.*"/>
      <cat-item lemma="juliol" tags="n.*"/>
      <cat-item lemma="agost" tags="n.*"/>
      <cat-item lemma="setembre" tags="n.*"/>
      <cat-item lemma="octubre" tags="n.*"/>
      <cat-item lemma="novembre" tags="n.*"/>
      <cat-item lemma="desembre" tags="n.*"/>
    </def-cat>
    <def-cat n="any">
      <cat-item lemma="any" tags="n.*"/>
    </def-cat>
    <def-cat n="n_temps">
      <cat-item lemma="dia" tags="n.*"/>
      <cat-item lemma="setmana" tags="n.*"/>
      <cat-item lemma="mes" tags="n.*"/>
      <cat-item lemma="any" tags="n.*"/>
      <cat-item lemma="dilluns" tags="n.*"/>
      <cat-item lemma="dimarts" tags="n.*"/>
      <cat-item lemma="dimecres" tags="n.*"/>
      <cat-item lemma="dijous" tags="n.*"/>
      <cat-item lemma="divendres" tags="n.*"/>
      <cat-item lemma="dissabte" tags="n.*"/>
      <cat-item lemma="diumenge" tags="n.*"/>
    </def-cat>
    <def-cat n="multiHiha">
      <cat-item lemma="hi ha" tags="vblex.pri.p3.sg"/>
    </def-cat>
    <def-cat n="anar">
      <cat-item lemma="anar" tags="vblex.pri.*"/>
    </def-cat>
    <def-cat n="molt">
      <cat-item lemma="molt" tags="preadv"/>
      <cat-item lemma="molt" tags="adv"/>
      <cat-item lemma="molt" tags="adj.m.sg"/>
    </def-cat>
    <def-cat n="comp">
      <cat-item lemma="tant" tags="adj.*"/>
      <cat-item lemma="més" tags="adv"/>
      <cat-item lemma="menys" tags="adv"/>
    </def-cat>
    <def-cat n="lopronom">
      <cat-item lemma="el" tags="prn.pro.p3.mf.sg"/>
    </def-cat>
    <def-cat n="nosaltres">
      <cat-item lemma="nosaltres" tags="prn.tn.p1.mf.pl"/>
      <cat-item lemma="vosaltres" tags="prn.tn.p2.mf.pl"/>
    </def-cat>
    <def-cat n="en">
      <cat-item lemma="en" tags="pr"/>
    </def-cat>
    <def-cat n="a">
      <cat-item lemma="a" tags="pr"/>
    </def-cat>
    <def-cat n="per">
      <cat-item lemma="per" tags="pr"/>
    </def-cat>
    <def-cat n="dir">
      <cat-item lemma="dir" tags="vblex.pri.*"/>
      <cat-item lemma="dir" tags="vblex.fti.*"/>
    </def-cat>
    <def-cat n="haver">
      <cat-item lemma="haver" tags="vbhaver.*"/>
    </def-cat>
    <def-cat n="sent">
      <cat-item tags="sent"/>
    </def-cat>
    <def-cat n="sentquecm">
      <cat-item tags="sent"/>
      <cat-item tags="cnjsub"/>
      <cat-item tags="cm"/>
      <cat-item tags="cnjcoo"/>
    </def-cat>
  </section-def-cats>
  
  <section-def-attrs>
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
    </def-attr>
    <def-attr n="a_npant">
      <attr-item tags="np.ant"/>
    </def-attr>
    <def-attr n="a_nploc">
      <attr-item tags="np.loc"/>
    </def-attr>
    <def-attr n="a_det">
      <attr-item tags="det.def"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.pos"/>
      <attr-item tags="predet"/>
    </def-attr>
    <def-attr n="a_detdef">
      <attr-item tags="det.def"/>
    </def-attr>
    <def-attr n="a_predet">
      <attr-item tags="predet"/>
    </def-attr>
    <def-attr n="a_adjec">
      <attr-item tags="adj.ind"/>     
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
      <attr-item tags="vblex.pp"/>
    </def-attr>
    <def-attr n="a_adj">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
    </def-attr>
     <def-attr n="a_sup">
      <attr-item tags="sup"/>
    </def-attr>
    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="preadv"/>
    </def-attr>
    <def-attr n="a_prep">
      <attr-item tags="pr"/>
    </def-attr>
    <def-attr n="a_relat">
      <attr-item tags="rel.adv"/>
      <attr-item tags="rel.nn"/>
      <attr-item tags="rel.aa"/>
      <attr-item tags="rel.an"/>
    </def-attr>
    <def-attr n="a_prn">
      <attr-item tags="prn.tn.p1"/>
      <attr-item tags="prn.tn.p2"/>
      <attr-item tags="prn.tn.p3"/>
      <attr-item tags="prn.tn"/>
      <attr-item tags="prn.tn.ref.p3"/>
      <attr-item tags="prn.tn.pos"/>
      <attr-item tags="prn.itg"/>
    </def-attr>
    <def-attr n="a_prnenc">
      <attr-item tags="prn.enc"/>
      <attr-item tags="prn.enc.ref"/>
      <attr-item tags="prn.enc.adv"/>
    </def-attr>
    <def-attr n="a_prnpro">
      <attr-item tags="prn.pro"/>
      <attr-item tags="prn.pro.ref"/>
    </def-attr>
    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/>
    </def-attr>
    <def-attr n="a_inf">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbser.inf"/>
      <attr-item tags="vbhaver.inf"/>
      <attr-item tags="vbmod.inf"/>
    </def-attr>
    <def-attr n="a_infnm">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbser.inf"/>
      <attr-item tags="vbhaver.inf"/>
    </def-attr>
    <def-attr n="a_infnh">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbser.inf"/>
      <attr-item tags="vbmod.inf"/>
    </def-attr>
    <def-attr n="a_pp">
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbser.pp"/>
      <attr-item tags="vbhaver.pp"/>
      <attr-item tags="vbmod.pp"/>
    </def-attr>
    <def-attr n="a_num">
      <attr-item tags="num"/>
    </def-attr>
    <def-attr n="a_xifra">
      <attr-item tags="num"/>
    </def-attr>
    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>
    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>
    <def-attr n="persona">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>
    <def-attr n="tipoadv">
      <attr-item tags="itg"/>
    </def-attr>
    <def-attr n="tipoenc_pro">
      <attr-item tags="ref.p3.mf.sp"/>
      <attr-item tags="p1.mf.sg"/>
      <attr-item tags="p1.mf.pl"/>
      <attr-item tags="p2.mf.sg"/>
      <attr-item tags="p2.mf.pl"/>
      <attr-item tags="p3.mf.sg"/>
      <attr-item tags="p3.mf.pl"/>
      <attr-item tags="p3.mf.sp"/>
      <attr-item tags="p3.m.sg"/>
      <attr-item tags="p3.m.pl"/>
      <attr-item tags="p3.f.sg"/>
      <attr-item tags="p3.f.pl"/>
      <attr-item tags="p3.nt"/>
      <attr-item tags="adv"/>
    </def-attr>
    <def-attr n="temps">
      <attr-item tags="inf"/>
      <attr-item tags="ger"/>
      <attr-item tags="pp"/>
      <attr-item tags="pri"/>
      <attr-item tags="ifi"/>
      <attr-item tags="pii"/>
      <attr-item tags="fti"/>
      <attr-item tags="cni"/>
      <attr-item tags="prs"/>
      <attr-item tags="pis"/>
      <attr-item tags="fts"/>
      <attr-item tags="imp"/>
    </def-attr>
  </section-def-attrs>
  
  <section-def-vars>
    <def-var n="uno"/>
    <def-var n="genero"/>
    <def-var n="numero"/>
    <def-var n="concDet"/>
    <def-var n="concAdj"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="interrogativa"/>
    <def-var n="exclamativa"/>
  </section-def-vars>
  <section-def-lists>
    <def-list n="verbs_moviment">
      <list-item v="anar"/>
      <list-item v="traslladar"/>
      <list-item v="viatjar"/>
      <list-item v="emigrar"/>
      <list-item v="inmigrar"/>
      <list-item v="moure"/>
      <list-item v="venir"/>
      <list-item v="vindre"/>
      <list-item v="eixir"/>
      <list-item v="sortir"/>
      <list-item v="entrar"/>
      <list-item v="pujar"/>
      <list-item v="baixar"/>
      <list-item v="caminar"/>
      <list-item v="dirigir"/>
      <list-item v="apropar"/>
      <list-item v="córrer"/>
      <list-item v="portar"/>
      <list-item v="passar"/>
      <list-item v="tornar"/>
      <list-item v="regressar"/>
      <list-item v="arribar"/>
      <list-item v="marxar"/>
    </def-list>
    <def-list n="verbs_estat">
      <list-item v="conviure"/>
      <list-item v="viure"/>
      <list-item v="actuar"/>
      <list-item v="allotjar"/>
      <list-item v="assentar"/>
      <list-item v="buscar"/>
      <list-item v="celebrar"/>
      <list-item v="centralitzar"/>
      <list-item v="cercar"/>
      <list-item v="col·locar"/>
      <list-item v="concentrar"/>
      <list-item v="desembocar"/>
      <list-item v="endinsar"/>
      <list-item v="establir"/>
      <list-item v="estrenar"/>
      <list-item v="excavar"/>
      <list-item v="exercir"/>
      <list-item v="existir"/>
      <list-item v="exposar"/>
      <list-item v="ficar"/>
      <list-item v="inaugurar"/>
      <list-item v="incloure"/>
      <list-item v="indagar"/>
      <list-item v="ingressar"/>
      <list-item v="inserir"/>
      <list-item v="instal·lar"/>
      <list-item v="introduir"/>
      <list-item v="irrompre"/>
      <list-item v="penetrar"/>
      <list-item v="pescar"/>
      <list-item v="publicar"/>
      <list-item v="reunir"/>
      <list-item v="romandre"/>
      <list-item v="treballar"/>
      <list-item v="trobar"/>
      <list-item v="ubicar"/>
      <list-item v="estudiar"/>
    </def-list>
    <def-list n="vbambser">
      <list-item v="anar"/>
      <list-item v="tornar"/>      
      <list-item v="venir"/>
      <list-item v="vindre"/>      
      <list-item v="arribar"/>
      <list-item v="partir"/>
      <list-item v="néixer"/>
      <list-item v="morir"/>
      <list-item v="baixar"/>
      <list-item v="pujar"/>
      <list-item v="entrar"/>
      <list-item v="sortir"/>
      <list-item v="eixir"/>
      <list-item v="caure"/>
      <list-item v="retornar"/>
      <list-item v="passar"/>
      <list-item v="quedar"/>
      <list-item v="esdevenir"/>
    </def-list>
    <def-list n="mesos">
      <list-item v="gener"/>
      <list-item v="febrer"/>
      <list-item v="març"/>
      <list-item v="abril"/>
      <list-item v="maig"/>
      <list-item v="juny"/>
      <list-item v="juliol"/>
      <list-item v="agost"/>
      <list-item v="setembre"/>
      <list-item v="octubre"/>
      <list-item v="novembre"/>
      <list-item v="desembre"/>
    </def-list>
    
    
	<def-list n="part_sing">
		<list-item v="eau"/>
		<list-item v="beurre"/>
		<list-item v="limonade"/>
		<list-item v="vin"/>
		<list-item v="bière"/>
		<list-item v="viande"/>
		<list-item v="pain"/>
	</def-list>
    
  </section-def-lists>
  
  <section-def-macros>
    <def-macro n="f_pis2prs" npar="1"> <!-- canviem tots els pis per prs -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="temps"/>
              <lit-tag v="pis"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="temps"/>
            <lit-tag v="prs"/>
          </let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="f_setpronom" npar="1">
<!--
      <choose>
        <when>
          <test>
            <equal>
              <case-of pos="1" side="sl" part="lem"/>
              <lit v="Aa"/>
            </equal>
          </test>
          <modify-case>
            <clip pos="1" side="tl" part="lem"/>
            <lit v="aa"/>
          </modify-case>
        </when>
      </choose>
-->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="persona"/>
              <lit-tag v="p1"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="je"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="pl"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v="nous"/>
                  </let>
                </when>
              </choose>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="persona"/>
                  <lit-tag v="p2"/>
                </equal>
              </test>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="sg"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v="tu"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="1" side="tl" part="nbr"/>
                          <lit-tag v="pl"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="1" side="sl" part="lem"/>
                        <lit v="vous"/>
                      </let>
                    </when>
                  </choose>
                </otherwise>
              </choose>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="persona"/>
                      <lit-tag v="p3"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v="il"/>
                  </let>
                </when>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>

      <modify-case>
        <clip pos="1" side="sl" part="lem"/>
        <case-of pos="1" side="tl" part="lem"/>
      </modify-case>
    </def-macro>
    
    <def-macro n="f_setgen" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="sl" part="gen"/>
                <lit-tag v="m"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="gen"/>
                      <lit-tag v="f"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="1" side="sl" part="gen"/>
                    <lit-tag v="f"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="1" side="tl" part="gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="1" side="sl" part="gen"/>
                        <lit-tag v="m"/>
                      </let>
                    </when>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <or>
                  <equal>
                    <clip pos="1" side="tl" part="nbr"/>
                    <lit-tag v="pl"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </or>
              </test>
              <let>
                <clip pos="1" side="sl" part="gen"/>
                <lit-tag v="mf"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="1" side="sl" part="nbr"/>
                    <lit-tag v="pl"/>
                  </let>
                </when>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>
    
    <def-macro n="f_bcond" npar="2">
<!--Per mirar si el blanc conté o no format -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <b pos="1"/>
                <lit v=" "/>
              </equal>
            </not>
          </test>
          <out>
            <b pos="1"/>
          </out>
        </when>
      </choose>
    </def-macro>  
    
    <def-macro n="superlatiu" npar="1">
<!--Per modificar el superlatiu per très + adj -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_sup"/>
              <lit-tag v="sup"/>
            </equal>  
  </test>   
  <out>
    <lu>
              <lit v="très"/>
      <lit-tag v="preadv"/>
            </lu>
    <b/>
  </out>  
        </when>   
      </choose>
    </def-macro>
    
    <def-macro n="f_modimp" npar="1">
<!--Per canviar la 3a persona d'imperatiu per 2a del plural -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="persona"/>
              <lit-tag v="p3"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="persona"/>
            <lit-tag v="p2"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <lit-tag v="pl"/>
          </let>
        </when>
      </choose>
    </def-macro>
    
    <def-macro n="f_outverb2" npar="2">
<!--Comprueba si hay pronombres que se traducen por nada de catalán a español según el diccionario ("hi" y "en") y envía el verbo con o sin pronombres de acuerdo con esta comprobación. Esta función es para el caso de verbo + 1 enclítico.-->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <clip pos="2" side="tl" part="lem"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <out>
            <mlu>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_prnenc"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </out>
        </when>
        <otherwise>
          <out>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </out>
        </otherwise>
      </choose>
    </def-macro>
    
    <def-macro n="f_outverb3" npar="3">
<!--Comprueba si hay pronombres que se traducen por nada de catalán a español según el diccionario ("hi" y "en") y envía el verbo con o sin pronombres de acuerdo con esta comprobación. Esta función es para el caso de verbo + 2 enclíticos.-->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <clip pos="2" side="tl" part="lem"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="3" side="tl" part="lem"/>
                    <lit v=""/>
                  </equal>
                </not>
              </test>
              <out>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                    <clip pos="1" side="tl" part="persona"/>
                    <clip pos="1" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prnenc"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_prnenc"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </out>
            </when>
            <otherwise>
              <out>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                    <clip pos="1" side="tl" part="persona"/>
                    <clip pos="1" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prnenc"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </out>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <out>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </out>
        </otherwise>
      </choose>
    </def-macro>
    
    <def-macro n="f_concord_pedac" npar="1">
<!--Pedaç totalment ad-hoc per solucionar problmes amb l'assignació del gènere i nombre a heureux, feliç > joyeux -->
      <choose>
        <when>
          <test>
            <and>
              <equal><clip pos="1" side="tl" part="lem"/><lit v="joyeux"/></equal>
              <equal><clip pos="1" side="tl" part="gen"/><lit-tag v="m"/></equal>
              <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></equal>
            </and>
          </test>
          <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="sp"/></let>
        </when>
      </choose>
    </def-macro>
    
    <def-macro n="f_concord1" npar="1">
      <choose>
<!--To determine value of variables of gender and
                 number and propagate to other rules.  Variables are
                 not used again in this rule -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- If word has GD or ND, we try to assign the
              gender or number of the previous rule. If there is no
              value for the gender or number variable from previous
              rules, gender will be masculine and number singular.-->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genero"/>
                  <lit-tag v="f"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="f"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="numero"/>
                  <lit-tag v="pl"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="pl"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sg"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
    </def-macro>
    
    <def-macro n="f_concord2" npar="2">
      <choose>
        <when>
          <test>
<!-- do the main and second parameter gender agree?-->
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
<!-- do the main and second parameter number agree?-->
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
<!-- there is gender and number agreement-->
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
<!-- there isn't gender and number agreement-->
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
<!-- Propagate the main parameter gender if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- Propagate the main parameter number if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- Which is the rule general gender? -->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
<!-- Which is the rule general number? -->
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Determine gender and number value if they are undetermined -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="2"/></call-macro>
    </def-macro>
    
    <def-macro n="f_concord3" npar="3">
      <choose>
<!-- Look if in source language there is concordance between first and second element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Look if in source language there is concordance between second and third element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Propagate the main parameter gender if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Propagate the main parameter number if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Determine the rule general gender. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="3" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Determine the rule general number. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Assign values to GD and ND -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="2"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="3"/></call-macro>
    </def-macro>
    
    <def-macro n="f_concord4" npar="4">
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concTercero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concTercero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="2"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="3"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="4"/></call-macro>
    </def-macro>
    
    <def-macro n="f_lexicAdj" npar="1">
      <choose>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="1" side="tl" part="lem"/>
                <lit v="bo"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sg"/>
              </equal>
            </and>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/>
            <get-case-from pos="1">
              <lit v="bon"/>
            </get-case-from>
          </let>
        </when>
      </choose>
    </def-macro>
  </section-def-macros>
  
  <section-rules>
<!--regles de concordança-->
    <rule>
<!-- REGLA: DETERMINANT -->
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
     
    <rule comment="REGLA: LOPRONOM">
      <pattern>
        <pattern-item n="lopronom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    

    <rule comment="REGLA: NOM">
      <pattern>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: ADJECTIU -->
      <pattern>
        <pattern-item n="adjec"/>
      </pattern>
      <action> 
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="superlatiu">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_adjec"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: PRONOM -->
<!--Special case, macro f_concord1 
is not applicable because gender and number can not be taken from previous rules -->
      <pattern>
        <pattern-item n="prn"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="GD"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_prn"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NUMERAL-->
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: RELAT -->
      <pattern>
        <pattern-item n="relat"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DETERMINANT NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NOM ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
   <call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: ADJECTIU NOM -->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_lexicAdj">
          <with-param pos="1"/>
        </call-macro>
   <call-macro n="superlatiu">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
   <call-macro n="superlatiu">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DET NOM ADJECTIU ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="3"/>       
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="4"/>       
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NOM ADJECTIU ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DET ADJECTIU NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_lexicAdj">
          <with-param pos="2"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: PREDET DET NOM-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: PREDET DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DETERMINANT ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: ADJECTIU NOM ADJECTIU-->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_lexicAdj">
          <with-param pos="1"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="1"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DET ADJECTIU NOM ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_lexicAdj">
          <with-param pos="2"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NOM ADVERBI ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="3"/>
        </call-macro> 
<out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="DET NOM ADVERBI ADJECTIU: l'home molt alt > l'homme très haut, l'home més alt > l'homme le plus haut">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="superlatiu">
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="el"/></equal>
                <or>
                  <equal caseless="yes"><clip pos="3" side="sl" part="lem"/><lit v="més"/></equal>
                  <equal caseless="yes"><clip pos="3" side="sl" part="lem"/><lit v="menys"/></equal>
                </or>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="1" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="1" side="tl" part="tags"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DET ADVERBI NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adv"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NUMERAL NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NUMERAL ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NUMERAL NOM ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: NUMERAL ADJECTIU NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_lexicAdj">
          <with-param pos="2"/>
        </call-macro>
<call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: DET NUMERAL NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: NUMERAL de MES de NUM  20 de novembre de 1998: 20 novembre 1998-->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="deprep"/>
        <pattern-item n="mes"/>
        <pattern-item n="deprep"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
      <equal>
       	 <clip pos="1" side="sl" part="lem"/>
	  <lit v="1"/>
      </equal> 
            </test>
            <out>
              <lu>
                <lit v="1er"/>
                <lit-tag v="adj.m.sg"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
        <out>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: NUMERAL de MES , 20 de novembre: 20 novembre-->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="deprep"/>
        <pattern-item n="mes"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
      <equal>
       	 <clip pos="1" side="sl" part="lem"/>
	  <lit v="1"/>
      </equal> 
            </test>
            <out>
              <lu>
                <lit v="1er"/>
                <lit-tag v="adj.m.sg"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
        <out>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
<!--fi regles de concordança-->
    <rule>
<!-- REGLA: PRETÈRIT INDEFINIT -->
<!-- Per traduir "vaig fer" per "ai fait" -->
      <pattern>
        <pattern-item n="anar"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
      <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="2" side="sl" part="lem"/>
                <list n="vbambser"/>
              </in>
            </test>
 <out>
          <lu>
            <get-case-from pos="1">
              <lit v="être"/>
            </get-case-from>
            <lit-tag v="vbser"/>
            <lit-tag v="pri"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
       </when>
       <otherwise>  
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="avoir"/>
            </get-case-from>
            <lit-tag v="vbhaver"/>
            <lit-tag v="pri"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
    </choose>  	
  </action>
</rule>
    
    <rule>
<!-- REGLA: PRETÈRIT INDEFINIT -->
<!-- Per traduir "vaig fer" per "ai fait" -->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="anar"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
      <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <list n="vbambser"/>
              </in>
            </test>
 <out>
          <lu>
            <get-case-from pos="2">
              <lit v="être"/>
            </get-case-from>
            <lit-tag v="vbser"/>
            <lit-tag v="pri"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
       </when>
       <otherwise>  
        <out>
          <lu>
            <get-case-from pos="2">
              <lit v="avoir"/>
            </get-case-from>
            <lit-tag v="vbhaver"/>
            <lit-tag v="pri"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
    </choose>  	
  </action>
</rule>
    
    <rule>
<!-- REGLA: PRETÈRIT INDEFINIT + ENCLÍTIC -->
<!-- Per a traduir "van comprar-me" per "m'ont acheté" -->
      <pattern>
        <pattern-item n="anar"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="3" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="prn.pro"/>
            <clip pos="3" side="tl" part="tipoenc_pro"/>
          </lu>
          <b pos="1"/>
          <lu>
            <lit v="avoir"/>
            <lit-tag v="vbhaver"/>
            <lit-tag v="pri"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!-- REGLA: PRETÈRIT INDEFINIT + ENCLÍTIC + ENCLÍTIC -->
<!-- Per traduir "van acabar-se'ls" per "les ont fini" -->
      <pattern>
        <pattern-item n="anar"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="4" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="prn.pro"/>
            <clip pos="4" side="tl" part="tipoenc_pro"/>
          </lu>
          <b pos="1"/>
          <lu>
            <lit v="avoir"/>
            <lit-tag v="vbhaver"/>
            <lit-tag v="pri"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: GERUNDI -->
      <pattern>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="en"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b/>
          </out>
          <modify-case>
            <clip pos="1" side="tl" part="lemh"/>
            <lit v="aa"/>
          </modify-case>
          <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: imp -->
      <pattern>
        <pattern-item n="imp"/>
      </pattern>
      <action>
        <call-macro n="f_modimp">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: sent imp -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="imp"/>
      </pattern>
      <action>
        <call-macro n="f_modimp">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: inf -->
      <pattern>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: verb en forma personal-->
      <pattern>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
  
  
     <rule>
<!--REGLA: verb en forma personal + nom -->
      <pattern>
        <pattern-item n="verb_conj"/>
<pattern-item n="nom"/>
      </pattern>
      <action>
       <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>  
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
<choose>
  <when>
    <test>
      <equal>
        <clip pos="1" side="tl" part="temps"/>
	<lit-tag v="imp"/>
      </equal>
    </test>
  <call-macro n="f_modimp">
          <with-param pos="1"/>
        </call-macro>
</when>
</choose>
<choose>
          <when>
            <test>
     <or>
              <equal>
                <clip pos="2" side="sl" part="nbr"/>
                <lit-tag v="pl"/>
              </equal>
      <in caseless="yes">
	 <clip pos="2" side="tl" part="lem"/>
	 <list n="part_sing"/>
	</in>
     </or> 
            </test>
            <out>
      <lu>
            	<clip pos="1" side="tl" part="lemh"/>
           	<clip pos="1" side="tl" part="a_verb"/>
            	<clip pos="1" side="tl" part="temps"/>
            	<clip pos="1" side="tl" part="persona"/>
	<clip pos="1" side="tl" part="gen"/>
            	<clip pos="1" side="tl" part="nbr"/>
            	<clip pos="1" side="tl" part="lemq"/>
              </lu>
      <b pos="1"/>
      <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
	<clip pos="2" side="tl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
              </lu>
    </out> 
   </when>
          <otherwise>
            <out>
                <lu>
            	<clip pos="1" side="tl" part="lemh"/>
           	<clip pos="1" side="tl" part="a_verb"/>
            	<clip pos="1" side="tl" part="temps"/>
            	<clip pos="1" side="tl" part="persona"/>
	<clip pos="1" side="tl" part="gen"/>
            	<clip pos="1" side="tl" part="nbr"/>
            	<clip pos="1" side="tl" part="lemq"/>
              </lu>
      <b pos="1"/>
              <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose> 
      </action>
  </rule>
    
    <rule>
<!--REGLA: no+ verb en forma personal-->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <out>
  <lu>
             <clip pos="1" side="tl" part="whole"/>
          </lu>
       <b pos="1"/>
          <lu>
        	<clip pos="2" side="tl" part="lemh"/>
           	<clip pos="2" side="tl" part="a_verb"/>
            	<clip pos="2" side="tl" part="temps"/>
            	<clip pos="2" side="tl" part="persona"/>
	<clip pos="2" side="tl" part="gen"/>		
            	<clip pos="2" side="tl" part="nbr"/>
            	<clip pos="2" side="tl" part="lemq"/>
          </lu>
      <b/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
        </out>
      </action>
  </rule> 
  
  
    <rule>
<!--REGLA: no+ verb en infinitiu -->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
  <lu>
             <clip pos="1" side="tl" part="whole"/>
          </lu>
      <b/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
       <b pos="1"/>
          <lu>
        	<clip pos="2" side="tl" part="lemh"/>
           	<clip pos="2" side="tl" part="a_verb"/>
            	<clip pos="2" side="tl" part="temps"/>
            	<clip pos="2" side="tl" part="persona"/>
	<clip pos="2" side="tl" part="gen"/>		
            	<clip pos="2" side="tl" part="nbr"/>
            	<clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule> 
  
  
    <rule>
<!--REGLA: no+ verb en forma personal + pas, gens, gaire, etc.-->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="negadv"/>
      </pattern>
      <action>
        <out>
  <lu>
             <clip pos="1" side="tl" part="whole"/>
          </lu>
       <b pos="1"/>
          <lu>
        	<clip pos="2" side="tl" part="lemh"/>
           	<clip pos="2" side="tl" part="a_verb"/>
            	<clip pos="2" side="tl" part="temps"/>
            	<clip pos="2" side="tl" part="persona"/>
	<clip pos="2" side="tl" part="gen"/>		
            	<clip pos="2" side="tl" part="nbr"/>
            	<clip pos="2" side="tl" part="lemq"/>
          </lu>
      <b pos="2"/>
  <lu>
             <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
  </rule> 
  
  
    <rule>
<!--REGLA: no+ prnpro + verb en forma personal: no en vull > je n'en veux pas-->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <out>
  <lu>
             <clip pos="1" side="tl" part="whole"/>
          </lu>
       <b pos="1"/>
  <lu>
             <clip pos="2" side="tl" part="whole"/>
          </lu>
       <b pos="2"/>
          <lu>
        	<clip pos="3" side="tl" part="lemh"/>
           	<clip pos="3" side="tl" part="a_verb"/>
            	<clip pos="3" side="tl" part="temps"/>
            	<clip pos="3" side="tl" part="persona"/>
	<clip pos="3" side="tl" part="gen"/>		
            	<clip pos="3" side="tl" part="nbr"/>
            	<clip pos="3" side="tl" part="lemq"/>
          </lu>
       <b/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
        </out>
      </action>
  </rule> 
  
  
    <rule>
<!--REGLA: no+ prnpro + prnpro + verb en forma personal: no n'hi vull > je n'en y veux pas-->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <out>
  <lu>
             <clip pos="1" side="tl" part="whole"/>
          </lu>
       <b pos="1"/>
  <lu>
             <clip pos="2" side="tl" part="whole"/>
          </lu>
       <b pos="2"/>
  <lu>
             <clip pos="3" side="tl" part="whole"/>
          </lu>
       <b pos="3"/>
          <lu>
        	<clip pos="4" side="tl" part="lemh"/>
           	<clip pos="4" side="tl" part="a_verb"/>
            	<clip pos="4" side="tl" part="temps"/>
            	<clip pos="4" side="tl" part="persona"/>
	<clip pos="4" side="tl" part="gen"/>		
            	<clip pos="4" side="tl" part="nbr"/>
            	<clip pos="4" side="tl" part="lemq"/>
          </lu>
       <b/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
        </out>
      </action>
  </rule> 
  
  
    <rule>
<!--REGLA: no+ verb en forma personal + nom-->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
<pattern-item n="nom"/>
      </pattern>
      <action>
<call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>  
<call-macro n="f_setgen">
          <with-param pos="3"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
<choose>
          <when>
            <test>
     <or>
              <equal>
                <clip pos="3" side="sl" part="nbr"/>
                <lit-tag v="pl"/>
              </equal>
      <in caseless="yes">
	 <clip pos="3" side="tl" part="lem"/>
	 <list n="part_sing"/>
	</in>
     </or> 
            </test>
          <out>
  <lu>
             <clip pos="1" side="tl" part="whole"/>
          </lu>
       <b pos="1"/>
          <lu>
        	<clip pos="2" side="tl" part="lemh"/>
           	<clip pos="2" side="tl" part="a_verb"/>
            	<clip pos="2" side="tl" part="temps"/>
            	<clip pos="2" side="tl" part="persona"/>
	<clip pos="2" side="tl" part="gen"/>
            	<clip pos="2" side="tl" part="nbr"/>
            	<clip pos="2" side="tl" part="lemq"/>
          </lu>
      <b pos="2"/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
  
      <b/>
      <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
	<clip pos="3" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
              </lu>
        </out>
</when>
<otherwise>
 <out>
  <lu>
             <clip pos="1" side="tl" part="whole"/>
          </lu>
       <b pos="1"/>
          <lu>
        	<clip pos="2" side="tl" part="lemh"/>
           	<clip pos="2" side="tl" part="a_verb"/>
            	<clip pos="2" side="tl" part="temps"/>
            	<clip pos="2" side="tl" part="persona"/>
	<clip pos="2" side="tl" part="gen"/>
            	<clip pos="2" side="tl" part="nbr"/>
            	<clip pos="2" side="tl" part="lemq"/>
          </lu>
      <b pos="2"/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
  <b/>
          <lu>
              <clip pos="3" side="tl" part="whole"/>
           </lu>
        </out>
      </otherwise>
    </choose>
   </action>
  </rule> 
  <rule>
<!--REGLA: verb en forma no personal + nom -->
      <pattern>
        <pattern-item n="verbnp"/>
<pattern-item n="nom"/>
      </pattern>
      <action>
<call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro> 
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
<choose>
          <when>
            <test>
     <or>
              <equal>
                <clip pos="2" side="sl" part="nbr"/>
                <lit-tag v="pl"/>
              </equal>
      <in caseless="yes">
	 <clip pos="2" side="tl" part="lem"/>
	 <list n="part_sing"/>
	</in>
     </or> 
            </test>
            <out>
                <lu>
            	<clip pos="1" side="tl" part="lemh"/>
           	<clip pos="1" side="tl" part="a_verb"/>
            	<clip pos="1" side="tl" part="temps"/>
            	<clip pos="1" side="tl" part="persona"/>
	<clip pos="1" side="tl" part="gen"/>
            	<clip pos="1" side="tl" part="nbr"/>
            	<clip pos="1" side="tl" part="lemq"/>
              </lu>
      <b pos="1"/>
      <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
	<clip pos="2" side="tl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out> 
  </when>
          <otherwise>
            <out>
                <lu>
            	<clip pos="1" side="tl" part="lemh"/>
           	<clip pos="1" side="tl" part="a_verb"/>
            	<clip pos="1" side="tl" part="temps"/>
            	<clip pos="1" side="tl" part="persona"/>
	<clip pos="1" side="tl" part="gen"/>
            	<clip pos="1" side="tl" part="nbr"/>
            	<clip pos="1" side="tl" part="lemq"/>
              </lu>
      <b pos="1"/>
              <lu>
              <clip pos="2" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>    
      </action>
  </rule>
    
     <rule>
<!--REGLA: prep + nom -->
      <pattern>
        <pattern-item n="prep"/>
<pattern-item n="nom"/>
      </pattern>
      <action>
<call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>  
<call-macro n="f_setgen">
          <with-param pos="2"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
<choose>
          <when>
          <test>
    <and>
      <not>
                <equal>
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="de"/>
                </equal>
       </not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="pl"/>
                </equal>
    </and>    
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
      <b pos="1"/>
      <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
	<clip pos="2" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
    </out> 
  </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
      <b pos="1"/>
              <lu>
              <clip pos="2" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose> 
      </action>
  </rule>
    
     <rule>
<!--REGLA: prep + tu -->
      <pattern>
        <pattern-item n="prep"/>
<pattern-item n="tu"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
            <b pos="1"/>
          <lu>
            <lit v="toi"/>
            <lit-tag v="prn.tn.p2.mf.sg"/>
          </lu>
        </out>
      </action>
  </rule>
    
     <rule>
<!--REGLA: prep + ell -->
      <pattern>
        <pattern-item n="prep"/>
<pattern-item n="ell"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
            <b pos="1"/>
          <lu>
            <lit v="lui"/>
            <lit-tag v="prn.pro.p3.mf.sg"/>
          </lu>
        </out>
      </action>
  </rule>
    
     <rule>
<!--REGLA: prep + ells -->
      <pattern>
        <pattern-item n="prep"/>
<pattern-item n="ells"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
            <b pos="1"/>
          <lu>
            <lit v="eux"/>
            <lit-tag v="prn.tn.p3.m.pl"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: dir-se -> s'apeller -->
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="dir"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="2"/>
        </call-macro>
        <modify-case>
          <clip pos="2" side="sl" part="lem"/>
          <case-of pos="1" side="sl" part="lemh"/>
        </modify-case>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="persona"/>
                <clip pos="2" side="sl" part="persona"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="lem"/>
              <lit v="appeler"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="1" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="1" side="tl" part="tags"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="1" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="1" side="tl" part="tags"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>  
    
    <rule comment="PRNREF HAVER PP > PRNREF SER PP: s'ha incorporat > s'est incorporé, m'ha dit > m'a dit"> 
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="haver"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <or>
                <and>
                  <equal><clip pos="1" side="sl" part="persona"/><clip pos="2" side="sl" part="persona"/></equal>
                  <or>
                    <equal><clip pos="1" side="sl" part="nbr"/><clip pos="2" side="sl" part="nbr"/></equal>
                    <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
                  </or>
                </and>
                <in caseless="yes"><clip pos="3" side="tl" part="lemh"/><list n="vbambser"/></in>
              </or>
            </test>
            <let><clip pos="2" side="tl" part="lem"/><lit v="être"/></let>
            <let><clip pos="2" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="3" side="tl" part="nbr"/><clip pos="2" side="sl" part="nbr"/></let>
            <choose>
              <when>
                <test>
                    <or>
                      <equal><var n="genero"/><lit-tag v="m"/></equal>
                      <equal><var n="genero"/><lit-tag v="f"/></equal>
                    </or>
                </test>
                <let><clip pos="3" side="tl" part="gen"/><var n="genero"/></let>
              </when>
            </choose>
          </when>
        </choose>
<!--
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="1" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="1" side="tl" part="tags"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="1" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="1" side="tl" part="tags"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
-->
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>  
    
    <rule>
<!--REGLA: NO PRNREF HAVER PP > NE PRNREF SER PAS PP: no s'ha incorporat > ne s'est pas incorporé -->
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="haver"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
<!--
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <clip pos="3" side="sl" part="persona"/>
              </equal>
            </test>
            <let><clip pos="3" side="tl" part="lem"/><lit v="être"/></let>
            <let><clip pos="3" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="4" side="tl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></let>
          </when>
        </choose>
-->
        <choose>
          <when>
            <test>
              <or>
                <and>
                  <equal><clip pos="2" side="sl" part="persona"/><clip pos="3" side="sl" part="persona"/></equal>
                  <or>
                    <equal><clip pos="2" side="sl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></equal>
                    <equal><clip pos="2" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
                  </or>
                </and>
                <in caseless="yes"><clip pos="4" side="tl" part="lemh"/><list n="vbambser"/></in>
              </or>
            </test>
            <let><clip pos="3" side="tl" part="lem"/><lit v="être"/></let>
            <let><clip pos="3" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="4" side="tl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></let>
            <choose>
              <when>
                <test>
                    <or>
                      <equal><var n="genero"/><lit-tag v="m"/></equal>
                      <equal><var n="genero"/><lit-tag v="f"/></equal>
                    </or>
                </test>
                <let><clip pos="4" side="tl" part="gen"/><var n="genero"/></let>
              </when>
            </choose>
          </when>
        </choose>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="tags"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>  
    
     <rule>
<!--REGLA: acabar de + inf -> venir de + inf -->
      <pattern>
        <pattern-item n="verb_conj"/>
<pattern-item n="deprep"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
          <lit v="venir"/>
	</get-case-from>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <clip pos="2" side="tl" part="whole"/>
      </lu>
      <b pos="2"/>   
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
             <lu>
                <get-case-from pos="2">
          <lit v="venir"/>
                </get-case-from>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <clip pos="2" side="tl" part="whole"/>
      </lu>
      <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
     <rule>
<!--REGLA: acabar de + inf + enc -> venir de + enc + inf -->
      <pattern>
        <pattern-item n="verb_conj"/>
<pattern-item n="deprep"/>
        <pattern-item n="inf"/>
<pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
          <lit v="venir"/>
                </get-case-from>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <clip pos="2" side="tl" part="whole"/>
      </lu>
      <b pos="2"/>
      <lu>
 	        <clip pos="4" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="4" side="tl" part="tipoenc_pro"/>
      </lu> 
      <b pos="3"/>    
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
             <lu>
                <get-case-from pos="2">
          <lit v="venir"/>
                </get-case-from>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <clip pos="2" side="tl" part="whole"/>
      </lu>
      <b pos="2"/>
      <lu>
        <clip pos="4" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="4" side="tl" part="tipoenc_pro"/>
      </lu> 
      <b pos="3"/>  
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

<!-- regles de generació de pronoms-->
    <rule>
<!--REGLA: SENT,que,coma,i VERB -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_setpronom">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_pis2prs">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="sl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </test>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <lit v="ce"/>
                    </get-case-from>
                    <lit-tag v="prn.tn.nt"/>
                  </lu>
                  <b/>
                </out>
                <modify-case>
                  <clip pos="2" side="tl" part="lemh"/>
                  <lit v="aa"/>
                </modify-case>
                <out>
                  <lu>
                    <clip pos="2" side="tl" part="lemh"/>
                    <clip pos="2" side="tl" part="a_verb"/>
                    <clip pos="2" side="tl" part="temps"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                    <clip pos="2" side="tl" part="lemq"/>
                  </lu>
                </out>
              </when>
              <otherwise>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="sl" part="lem"/>
                    <lit-tag v="prn.tn"/>
                    <clip pos="2" side="sl" part="persona"/>
                    <lit-tag v="m"/>
                    <clip pos="2" side="sl" part="nbr"/>
                  </lu>
                  <b/>
                </out>
                <modify-case>
                  <clip pos="2" side="tl" part="lemh"/>
                  <lit v="aa"/>
                </modify-case>
                <out>
                  <lu>
                    <clip pos="2" side="tl" part="lemh"/>
                    <clip pos="2" side="tl" part="a_verb"/>
                    <clip pos="2" side="tl" part="temps"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                    <clip pos="2" side="tl" part="lemq"/>
                  </lu>
                </out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
            <modify-case>
              <clip pos="2" side="tl" part="lemh"/>
              <lit v="aa"/>
            </modify-case>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule>
<!--REGLA: SENT,que,coma,i ser pp: seria expulsada > elle serait expulséeю -->
<!-- TBD després de coma, millor no afegir prn -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="vbser"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_setpronom">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_pis2prs">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <clip pos="3" side="sl" part="gen"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
            <modify-case>
              <clip pos="2" side="tl" part="lemh"/>
              <lit v="aa"/>
            </modify-case>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
            <modify-case>
              <clip pos="2" side="tl" part="lemh"/>
              <lit v="aa"/>
            </modify-case>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule>
<!--REGLA: SENT,que,coma,i + No + VERB -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="sl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </test>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <get-case-from pos="2">
                      <lit v="ce"/>
                    </get-case-from>
                    <lit-tag v="prn.tn.nt"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_adv"/>
                    <clip pos="2" side="tl" part="lemq"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="pas"/>
                    <lit-tag v="adv"/>
                  </lu>
                </out>
              </when>
              <otherwise>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <clip pos="3" side="sl" part="lem"/>
                    </get-case-from>
                    <lit-tag v="prn.tn"/>
                    <clip pos="3" side="sl" part="persona"/>
                    <lit-tag v="m"/>
                    <clip pos="3" side="sl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="pas"/>
                    <lit-tag v="adv"/>
                  </lu>
                </out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="2" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="2" side="tl" part="a_adv"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

<!-- ara amb pronom -->
    <rule>
<!--REGLA: SENT,que,coma,i PRN VERB: Li escriuen >> Ils lui écrivent -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_setpronom">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </otherwise>
        </choose>
        <modify-case>
          <clip pos="2" side="tl" part="lemh"/>
          <lit v="aa"/>
        </modify-case>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: PRNREF HAVER PP > PRNREF SER PP: s'ha incorporat > il s'est incorporé -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="haver"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_setpronom">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </otherwise>
        </choose>
        <modify-case>
          <clip pos="2" side="tl" part="lemh"/>
          <lit v="aa"/>
        </modify-case>
<!--
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <clip pos="2" side="sl" part="persona"/>
              </equal>
            </test>
            <let><clip pos="3" side="tl" part="lem"/><lit v="être"/></let>
            <let><clip pos="3" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="4" side="tl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></let>
          </when>
        </choose>
-->
        <choose>
          <when>
            <test>
              <or>
                <and>
                  <equal><clip pos="2" side="sl" part="persona"/><clip pos="3" side="sl" part="persona"/></equal>
                  <or>
                    <equal><clip pos="2" side="sl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></equal>
                    <equal><clip pos="2" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
                  </or>
                </and>
                <in caseless="yes"><clip pos="4" side="tl" part="lemh"/><list n="vbambser"/></in>
              </or>
            </test>
            <let><clip pos="3" side="tl" part="lem"/><lit v="être"/></let>
            <let><clip pos="3" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="4" side="tl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></let>
<!-- el pronom subjecte es crea en masculí, per tant deixem igual el gènere del participi
            <choose>
              <when>
                <test>
                    <or>
                      <equal><var n="genero"/><lit-tag v="m"/></equal>
                      <equal><var n="genero"/><lit-tag v="f"/></equal>
                    </or>
                </test>
                <let><clip pos="4" side="tl" part="gen"/><var n="genero"/></let>
              </when>
            </choose>
-->
          </when>
        </choose>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="tags"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: NO PRNREF HAVER PP > NE PRNREF SER PAS PP: no s'ha incorporat > il ne s'est pas incorporé -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="noadv"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="haver"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_setpronom">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <get-case-from pos="3">
                  <clip pos="4" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="4" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <get-case-from pos="3">
                  <clip pos="4" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="4" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </otherwise>
        </choose>
        <modify-case>
          <clip pos="3" side="tl" part="lemh"/>
          <lit v="aa"/>
        </modify-case>
<!--
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <clip pos="3" side="sl" part="persona"/>
              </equal>
            </test>
            <let><clip pos="4" side="tl" part="lem"/><lit v="être"/></let>
            <let><clip pos="4" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="5" side="tl" part="nbr"/><clip pos="4" side="sl" part="nbr"/></let>
          </when>
        </choose>
-->
        <choose>
          <when>
            <test>
              <or>
                <and>
                  <equal><clip pos="3" side="sl" part="persona"/><clip pos="4" side="sl" part="persona"/></equal>
                  <or>
                    <equal><clip pos="3" side="sl" part="nbr"/><clip pos="4" side="sl" part="nbr"/></equal>
                    <equal><clip pos="3" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
                  </or>
                </and>
                <in caseless="yes"><clip pos="5" side="tl" part="lemh"/><list n="vbambser"/></in>
              </or>
            </test>
            <let><clip pos="4" side="tl" part="lem"/><lit v="être"/></let>
            <let><clip pos="4" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="5" side="tl" part="nbr"/><clip pos="4" side="sl" part="nbr"/></let>
          </when>
        </choose>
        <out>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="tags"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="tags"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>

    <rule>
<!--REGLA: SENT,que,coma,i No PRN VERB: No li escriuen >> Ils ne lui écrivent pas -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="noadv"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_setpronom">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="4" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="4" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="4" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="4" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </otherwise>
        </choose>
        <modify-case>
          <clip pos="2" side="tl" part="lemh"/>
          <lit v="aa"/>
        </modify-case>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="tags"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule>
<!--REGLA: SENT,que,coma,i PRN VERB : Li vas dir >> Tu lui as dit, Hi vas anar >> Tu y es allé -->
<!-- ERROR!!!: Em vaig mirar >> Je m'ai regardé (en comptes de: je me suis regardé) -->
<!-- FALTA l'equivalent negatiu d'aquesta regla -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="anar"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_setpronom">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
            </out>
          </otherwise>
        </choose>
        <modify-case>
          <clip pos="2" side="tl" part="lemh"/>
          <lit v="aa"/>
        </modify-case>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
        </out>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="4" side="sl" part="lem"/>
                <list n="vbambser"/>
              </in>
            </test>
    <out>
              <lu>
                <lit v="être"/>
                <lit-tag v="vbser"/>
                <lit-tag v="pri"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <lit v="avoir"/>
                <lit-tag v="vbhaver"/>
                <lit-tag v="pri"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
            </out>
          </otherwise>
        </choose>
          <out>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
<!--ara amb nom-->
    <rule>
<!--REGLA: SENT,que,coma,i + VERB + NOM -->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_setgen">
          <with-param pos="3"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="sl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </test>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <lit v="ce"/>
                    </get-case-from>
                    <lit-tag v="prn.tn.nt"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_verb"/>
                    <clip pos="2" side="tl" part="temps"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                    <clip pos="2" side="tl" part="lemq"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                  </lu>
                </out>
              </when>
              <otherwise>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <clip pos="2" side="sl" part="lem"/>
                    </get-case-from>
                    <lit-tag v="prn.tn"/>
                    <clip pos="2" side="sl" part="persona"/>
                    <lit-tag v="m"/>
                    <clip pos="2" side="sl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lemh"/>
                    <clip pos="2" side="tl" part="a_verb"/>
                    <clip pos="2" side="tl" part="temps"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                    <clip pos="2" side="tl" part="lemq"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="le"/>
                    <lit-tag v="det.def"/>
                    <clip pos="3" side="sl" part="gen"/>
                    <var n="numero"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="tags"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
                </out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="2" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="3" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule>
<!--REGLA: SENT,que,coma,i + VERB + VERB + NOM-->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="verbnp"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="4" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <choose>
              <when>
            <test>
    <or>
              <equal>
                <clip pos="3" side="sl" part="a_verb"/>
                <lit-tag v="vbser"/>
              </equal>
      <not>
      <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="pl"/>
                </equal>
      </not>
      <not>
        <in caseless="yes">
	  <clip pos="2" side="tl" part="lem"/>
	  <list n="part_sing"/>
	</in>
      </not>	
    </or>  
            </test>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="sl" part="lem"/>
                    <lit-tag v="prn.tn"/>
                    <clip pos="2" side="sl" part="persona"/>
                    <lit-tag v="m"/>
                    <clip pos="2" side="sl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_verb"/>
                    <clip pos="2" side="tl" part="temps"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
                  <b pos="3"/>
                  <lu>
                    <clip pos="4" side="tl" part="whole"/>
                  </lu>
                </out>
              </when>
              <otherwise>
       <call-macro n="f_setgen">
          	<with-param pos="4"/>
               </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="4" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="sl" part="lem"/>
                    <lit-tag v="prn.tn"/>
                    <clip pos="2" side="sl" part="persona"/>
                    <lit-tag v="m"/>
                    <clip pos="2" side="sl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_verb"/>
                    <clip pos="2" side="tl" part="temps"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="le"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="sl" part="gen"/>
                    <var n="numero"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lemh"/>
                    <clip pos="4" side="tl" part="tags"/>
                    <clip pos="4" side="tl" part="lemq"/>
                  </lu>
                </out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="2" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="2" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="2" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="tags"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule>
<!--REGLA: sentquecm No + VERB + NOM-->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_setgen">
          <with-param pos="4"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="4" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="sl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </test>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <lit v="ce"/>
                    </get-case-from>
                    <lit-tag v="prn.tn.nt"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="pas"/>
                    <lit-tag v="adv"/>
                  </lu>
                </out>
              </when>
              <otherwise>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <clip pos="3" side="sl" part="lem"/>
                    </get-case-from>
                    <lit-tag v="prn.tn"/>
                    <clip pos="3" side="sl" part="persona"/>
                    <lit-tag v="m"/>
                    <clip pos="3" side="sl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="pas"/>
                    <lit-tag v="adv"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="le"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="sl" part="gen"/>
                    <var n="numero"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lemh"/>
                    <clip pos="4" side="tl" part="tags"/>
                    <clip pos="4" side="tl" part="lemq"/>
                  </lu>
                </out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="2" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="2" side="tl" part="a_adv"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="tags"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule>
<!--REGLA: sentquecm No + VERB + VERB + NOM-->
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="verbnp"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="f_setgen">
          <with-param pos="5"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="5" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="4" side="sl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </test>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <lit v="ce"/>
                    </get-case-from>
                    <lit-tag v="prn.tn.nt"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="pas"/>
                    <lit-tag v="adv"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lemh"/>
                    <clip pos="4" side="tl" part="a_verb"/>
                    <clip pos="4" side="tl" part="temps"/>
                    <clip pos="4" side="tl" part="persona"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="nbr"/>
                    <clip pos="4" side="tl" part="lemq"/>
                  </lu>
                </out>
              </when>
              <otherwise>
                <out>
                  <lu>
                    <clip pos="1" side="tl" part="whole"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <get-case-from pos="2">
                      <clip pos="3" side="sl" part="lem"/>
                    </get-case-from>
                    <lit-tag v="prn.tn"/>
                    <clip pos="3" side="sl" part="persona"/>
                    <lit-tag v="m"/>
                    <clip pos="3" side="sl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <get-case-from pos="3">
                      <clip pos="2" side="tl" part="lemh"/>
                    </get-case-from>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lemh"/>
                    <clip pos="3" side="tl" part="a_verb"/>
                    <clip pos="3" side="tl" part="temps"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="pas"/>
                    <lit-tag v="adv"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lemh"/>
                    <clip pos="4" side="tl" part="a_verb"/>
                    <clip pos="4" side="tl" part="temps"/>
                    <clip pos="4" side="tl" part="persona"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="nbr"/>
                    <clip pos="4" side="tl" part="lemq"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="le"/>
                    <lit-tag v="det.def"/>
                    <clip pos="5" side="sl" part="gen"/>
                    <var n="numero"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="5" side="tl" part="lemh"/>
                    <clip pos="5" side="tl" part="tags"/>
                    <clip pos="5" side="tl" part="lemq"/>
                  </lu>
                </out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="3" side="sl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.tn"/>
                <clip pos="3" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="2" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="2" side="tl" part="a_adv"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="persona"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="5" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="lemh"/>
                <clip pos="5" side="tl" part="tags"/>
                <clip pos="5" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
<!-- fi ara amb nom-->

<!--ara amb pronom-->
    <rule comment="PRN + VERB">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_pis2prs">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="PRN + No + VERB">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="PRETÈRIT INDEFINIT.  Per traduir 'vaig fer' per 'ai fait'">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="anar"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
        </out>
      <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <list n="vbambser"/>
              </in>
            </test>
 <out>
          <lu>
            <get-case-from pos="2">
              <lit v="être"/>
            </get-case-from>
            <lit-tag v="vbser"/>
            <lit-tag v="pri"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
       </when>
       <otherwise>  
        <out>
          <lu>
            <get-case-from pos="2">
              <lit v="avoir"/>
            </get-case-from>
            <lit-tag v="vbhaver"/>
            <lit-tag v="pri"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
    </choose>  	
  </action>
</rule>
    
    <rule comment="PRETÈRIT INDEFINIT.  Per traduir 'vaig fer' per 'ai fait'">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="noadv"/>
        <pattern-item n="anar"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
        </out>
      <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="4" side="sl" part="lem"/>
                <list n="vbambser"/>
              </in>
            </test>
 <out>
          <lu>
            <get-case-from pos="3">
              <lit v="être"/>
            </get-case-from>
            <lit-tag v="vbser"/>
            <lit-tag v="pri"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
       </when>
       <otherwise>  
        <out>
          <lu>
            <get-case-from pos="3">
              <lit v="avoir"/>
            </get-case-from>
            <lit-tag v="vbhaver"/>
            <lit-tag v="pri"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
          <b/>
          <lu>
            <lit v="pas"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="pp.m.sg"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
    </choose>  	
  </action>
</rule>
    
    <rule comment="PRN + VERB + NOM">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_setgen">
          <with-param pos="3"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_verb"/>
                <lit-tag v="vbser"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="3" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule comment="PRN + VERB + VERB + NOM">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="verbnp"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="4" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
    <or>
              <equal>
                <clip pos="3" side="sl" part="a_verb"/>
                <lit-tag v="vbser"/>
              </equal>
      <not>
      <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="pl"/>
                </equal>
      </not>
      <not>
        <in caseless="yes">
	  <clip pos="2" side="tl" part="lem"/>
	  <list n="part_sing"/>
	</in>
      </not>	
    </or>  
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
          <call-macro n="f_setgen">
            <with-param pos="4"/>
          </call-macro>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="3"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="tags"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule comment="PRN + No + VERB + NOM">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_setgen">
          <with-param pos="4"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="4" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="a_verb"/>
                <lit-tag v="vbser"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="3"/>
              <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="3"/>
              <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="tags"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule comment="PRN + No + VERB + VERB + NOM">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="noadv"/>
        <pattern-item n="verb_conj"/>
        <pattern-item n="verbnp"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="f_setgen">
          <with-param pos="5"/>
        </call-macro>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="sp"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="5" side="sl" part="nbr"/>
          </let>
        </when>
      </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="a_verb"/>
                <lit-tag v="vbser"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b pos="3"/>
              <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="persona"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
              <b pos="4"/>
              <lu>
                <clip pos="5" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b pos="3"/>
              <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="persona"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
              <b pos="4"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="le"/>
                <lit-tag v="det.def"/>
                <clip pos="5" side="sl" part="gen"/>
                <var n="numero"/>
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="lemh"/>
                <clip pos="5" side="tl" part="tags"/>
                <clip pos="5" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    
    
     <rule comment="prn + acabar de + inf -> prn + venir de + inf">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="verb_conj"/>
<pattern-item n="deprep"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
           <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
             <lu>
        <lit v="venir"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
        <clip pos="3" side="tl" part="whole"/>
      </lu>
      <b pos="3"/>   
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </out>
      </action>
    </rule>
    
     <rule comment="acabar de + inf + enc-> venir de + enc + inf">
      <pattern>
        <pattern-item n="prntn"/>
        <pattern-item n="verb_conj"/>
<pattern-item n="deprep"/>
        <pattern-item n="inf"/>
<pattern-item n="prnenc"/>
      </pattern>
      <action>
           <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
             <lu>
        <lit v="venir"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
        <clip pos="3" side="tl" part="whole"/>
      </lu>
      <b pos="3"/>  
      <lu>
        <clip pos="5" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="5" side="tl" part="tipoenc_pro"/>
      </lu> 
      <b pos="4"/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </out>
      </action>
    </rule>
    
<!-- fi ara amb pronom-->
<!-- fi regles generació pronom -->  

<rule comment="SENT + IMP + ENCLÍTIC">
      <pattern>
        <pattern-item n="sentquecm"/>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_modimp">
          <with-param pos="2"/>
        </call-macro>
        <out>
 <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <mlu>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prnenc"/>
              <clip pos="3" side="tl" part="persona"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
  </rule>
    
    <rule comment="IMP + ENCLÍTIC">
      <pattern>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_modimp">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <mlu>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prnenc"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
  </rule>
    
    <rule comment="GER + ENCLÍTIC">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <lit v="en"/>
            <lit-tag v="pr"/>
          </lu>
          <b/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <lit-tag v="prn.pro"/>
            <clip pos="2" side="tl" part="tipoenc_pro"/>
          </lu>
          <b/>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="INF + ENCLÍTIC">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <lit-tag v="prn.pro"/>
            <clip pos="2" side="tl" part="tipoenc_pro"/>
          </lu>
          <b/>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="NO + INF + ENCLÍTIC">
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
  </lu>
  <b/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
  <b/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <lit-tag v="prn.pro"/>
            <clip pos="3" side="tl" part="tipoenc_pro"/>
          </lu>
          <b/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="INF + ENCLÍTIC + ENCLÍTIC">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="li"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="el"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="2" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="2" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule comment="NO + INF + ENCLÍTIC + ENCLÍTIC: no donar-li'n > ne pas lui en donner">
      <pattern>
        <pattern-item n="noadv"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
  </lu>
  <b/>
  <lu>
                <lit v="pas"/>
                <lit-tag v="adv"/>
  </lu>
  <b/>
        </out>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="li"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="lem"/>
                  <lit v="el"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="4" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="4" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule comment="GER + ENCLÍTIC + ENCLÍTIC">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="li"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="el"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <lit v="en"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="2" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <lit v="en"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="2" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
  
       <rule comment="estar + ger -> être en train de + inf">
      <pattern>
        <pattern-item n="verb_conj"/>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
        <lit v="être"/>
                <lit-tag v="vbser"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <lit v="en"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
              <lu>
        <lit v="train"/>
	<lit-tag v="n.m.sg"/>
      </lu>
      <b/>
      <lu>
        <lit v="de"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>   
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
                 <lu>
        <lit v="être"/>
                <lit-tag v="vbser"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <lit v="en"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
              <lu>
        <lit v="train"/>
	<lit-tag v="n.m.sg"/>
      </lu>
      <b/>
      <lu>
        <lit v="de"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>   
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
     <rule comment="estar + ger + enc -> être en train de + enc + inf">
      <pattern>
        <pattern-item n="verb_conj"/>
        <pattern-item n="ger"/>
<pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_setpronom">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="p3"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="m"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
                 <lu>
        <lit v="être"/>
                <lit-tag v="vbser"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <lit v="en"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
              <lu>
        <lit v="train"/>
	<lit-tag v="n.m.sg"/>
      </lu>
      <b/>
      <lu>
        <lit v="de"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
      <lu>
 	        <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
      </lu> 
     <b/>   
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="sl" part="lem"/>
                <lit-tag v="prn.tn"/>
                <clip pos="1" side="sl" part="persona"/>
                <lit-tag v="mf"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
                 <lu>
        <lit v="être"/>
                <lit-tag v="vbser"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <lit v="en"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
              <lu>
        <lit v="train"/>
	<lit-tag v="n.m.sg"/>
      </lu>
      <b/>
      <lu>
        <lit v="de"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
      <lu>
        <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
      </lu> 
       <b/>   
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


 <rule comment="estar GER + ENCLÍTIC + ENCLÍTIC : être à pro inf">
      <pattern>
        <pattern-item n="verb_conj"/>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="li"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="lem"/>
                  <lit v="el"/>
                </equal>
              </and>
            </test>
            <out>
             <lu>
        <lit v="être"/>
                <lit-tag v="vbser"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <lit v="en"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
              <lu>
        <lit v="train"/>
	<lit-tag v="n.m.sg"/>
      </lu>
      <b/>
      <lu>
        <lit v="de"/>
	<lit-tag v="pr"/>
      </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="4" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
     <lu>
        <lit v="être"/>
                <lit-tag v="vbser"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
        <lit v="en"/>
	<lit-tag v="pr"/>
      </lu>
      <b/>
              <lu>
        <lit v="train"/>
	<lit-tag v="n.m.sg"/>
      </lu>
      <b/>
      <lu>
        <lit v="de"/>
	<lit-tag v="pr"/>
      </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="4" side="tl" part="tipoenc_pro"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>

    <rule comment="SENT + IMP + ENCLÍTIC + ENCLÍTIC">
      <pattern>        
        <pattern-item n="sentquecm"/>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_modimp">
          <with-param pos="2"/>
        </call-macro>
<!--  llevar fins que hi haja dobles enclítics al dic.fr  <choose>
<when>
          <test>
    <and>
     	      <equal>
     	        <clip pos="3" side="sl" part="lem"/>
     	        <lit v="li"/>
     	       </equal>
       <equal>
     	         <clip pos="4" side="sl" part="lem"/>
     	         <lit v="el"/>
     	       </equal>
     </and>  
           </test>-->
        <out>
 <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <mlu>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <lu>
              <clip pos="4" side="tl" part="lem"/>
              <clip pos="4" side="tl" part="a_prnenc"/>
              <clip pos="4" side="tl" part="persona"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
<!--  <lu>
        <clip pos="3" side="tl" part="lem"/>
        <clip pos="3" side="tl" part="a_prnenc"/>
        <clip pos="3" side="tl" part="persona"/>
        <clip pos="3" side="tl" part="gen"/>
        <clip pos="3" side="tl" part="nbr"/>
        <clip pos="1" side="tl" part="lemq"/>
      </lu>-->
          </mlu>
        </out>
<!--	</when>
<otherwise>
<out>
 <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
    <mlu>
      <lu>
        <clip pos="2" side="tl" part="lemh"/>
        <clip pos="2" side="tl" part="a_verb"/>
        <clip pos="2" side="tl" part="temps"/>
        <clip pos="2" side="tl" part="persona"/>
        <clip pos="2" side="tl" part="nbr"/>
      </lu>
      <lu>
        <clip pos="3" side="tl" part="lem"/>
        <clip pos="3" side="tl" part="a_prnenc"/>
        <clip pos="3" side="tl" part="persona"/>
        <clip pos="3" side="tl" part="gen"/>
        <clip pos="3" side="tl" part="nbr"/>
      </lu>  
      <lu>
        <clip pos="4" side="tl" part="lem"/>
        <clip pos="4" side="tl" part="a_prnenc"/>
        <clip pos="4" side="tl" part="persona"/>
        <clip pos="4" side="tl" part="gen"/>
        <clip pos="4" side="tl" part="nbr"/>
        <clip pos="1" side="tl" part="lemq"/>
      </lu>  
    </mlu>
          </out>
           </otherwise>
         </choose>-->
      </action>
  </rule>    

    <rule comment="IMP + ENCLÍTIC + ENCLÍTIC">
      <pattern>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_modimp">
          <with-param pos="1"/>
        </call-macro>
<!--  llevar fins que hi haja dobles enclítics al dic.fr  <choose>
<when>
          <test>
    <and>
     	      <equal>
     	        <clip pos="2" side="sl" part="lem"/>
     	        <lit v="li"/>
     	       </equal>
       <equal>
     	         <clip pos="3" side="sl" part="lem"/>
     	         <lit v="el"/>
     	       </equal>
     </and>  
           </test>-->
        <out>
          <mlu>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prnenc"/>
              <clip pos="3" side="tl" part="persona"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
<!--  <lu>
        <clip pos="2" side="tl" part="lem"/>
        <clip pos="2" side="tl" part="a_prnenc"/>
        <clip pos="2" side="tl" part="persona"/>
        <clip pos="2" side="tl" part="gen"/>
        <clip pos="2" side="tl" part="nbr"/>
        <clip pos="1" side="tl" part="lemq"/>
      </lu>-->
          </mlu>
        </out>
<!--	</when>
<otherwise>
<out>
    <mlu>
      <lu>
        <clip pos="1" side="tl" part="lemh"/>
        <clip pos="1" side="tl" part="a_verb"/>
        <clip pos="1" side="tl" part="temps"/>
        <clip pos="1" side="tl" part="persona"/>
        <clip pos="1" side="tl" part="nbr"/>
      </lu>
      <lu>
        <clip pos="2" side="tl" part="lem"/>
        <clip pos="2" side="tl" part="a_prnenc"/>
        <clip pos="2" side="tl" part="persona"/>
        <clip pos="2" side="tl" part="gen"/>
        <clip pos="2" side="tl" part="nbr"/>
      </lu>  
      <lu>
        <clip pos="3" side="tl" part="lem"/>
        <clip pos="3" side="tl" part="a_prnenc"/>
        <clip pos="3" side="tl" part="persona"/>
        <clip pos="3" side="tl" part="gen"/>
        <clip pos="3" side="tl" part="nbr"/>
        <clip pos="1" side="tl" part="lemq"/>
      </lu>  
    </mlu>
          </out>
           </otherwise>
         </choose>-->
      </action>
  </rule>
    
    <rule comment="EN + INF - EN + GERUNDI Comprovar traducció">
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="infnm"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="en"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="EN + INF'S - EN + GERUNDI Comprovar traducció">
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="infnm"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="en"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <lit-tag v="prn.pro"/>
            <clip pos="3" side="tl" part="tipoenc_pro"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
  </rule>
    
    <rule comment="l'any 1998 > en 1998">
      <pattern>
        <pattern-item n="detdef"/>
        <pattern-item n="any"/>
        <pattern-item n="xifra"/>
      </pattern>
      <action>
        <out>
          <lu>
            <lit v="en"/>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>

<!--comparatives-->
    <rule comment="tants/menys/més NOM com/que : autant/moins/plus de NOM que">
      <pattern>
        <pattern-item n="comp"/>
        <pattern-item n="nom"/>
        <pattern-item n="quecom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="tant"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="autant"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="que"/>
                <lit-tag v="cnjsub"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="que"/>
                <lit-tag v="cnjsub"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule comment="tants/menys/més NOM com/que : autant/moins/plus de NOM que de">
      <pattern>
        <pattern-item n="comp"/>
        <pattern-item n="nom"/>
        <pattern-item n="quecom"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="tant"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="autant"/>
                <lit-tag v="adv"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="que"/>
                <lit-tag v="cnjsub"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="que"/>
                <lit-tag v="cnjsub"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule comment="tan ADJ com: aussi ADJ que">
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adj"/>
        <pattern-item n="com"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="superlatiu">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="tan"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="aussi"/>
                <lit-tag v="adv"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="que"/>
                <lit-tag v="cnjsub"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
  </rule>
    
    <rule comment="tan ADV com: aussi ADV que">
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="com"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="tan"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="aussi"/>
                <lit-tag v="adv"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="que"/>
                <lit-tag v="cnjsub"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
<!-- fi comparatives -->

<!-- canvi de verb auxiliar en oracions reflexives o impersonals -->

<!--
<rule comment="regla: es haver pp">
   <pattern>
     <pattern-item n="es"/>
     <pattern-item n="haver-tmp-srd-cnj-p3"/>
     <pattern-item n="pp"/>
   </pattern>
   <action>
     <out>
       <chunk name="prn_aux_pp">
         <tags>
           <tag><lit-tag v="SV"/></tag>
         </tags>
           <lu>
             <clip pos="1" side="tl" part="lemh"/>
             <clip pos="1" side="tl" part="tags"/>
             <clip pos="1" side="tl" part="lemq"/>
           </lu>
           <b pos="1"/>
           <lu>
             <lit v="èssere"/>
             <lit-tag v="vbser"/>
             <clip pos="2" side="tl" part="temps"/>
             <clip pos="2" side="tl" part="pers"/>
             <clip pos="2" side="tl" part="nbr"/>
           </lu>
           <b pos="2"/>
           <lu>
             <clip pos="3" side="tl" part="lemh"/>
             <clip pos="3" side="tl" part="a_verb"/>
             <lit-tag v="pp"/>
             <var n="genero"/>
             <clip pos="2" side="tl" part="nbr"/>
             <clip pos="3" side="tl" part="lemq"/>
           </lu>
       </chunk>
     </out>
   </action>
</rule>
-->



<!-- fi canvi de verb auxiliar en oracions reflexives o impersonals -->

    <rule>
<!-- REGLA: reset variables-->
      <pattern>
        <pattern-item n="sent"/>
      </pattern>
      <action>
        <let>
         <var n="numero"/>
          <lit-tag v="sg"/>
        </let>
        <let>
          <var n="genero"/>
          <lit-tag v="m"/>
        </let>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
  </section-rules>
</transfer>
