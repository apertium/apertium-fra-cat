<?xml version="1.0" encoding="UTF-8"?>
<!-- -*- nxml -*- -->
<transfer>

  <section-def-cats>
  
    <def-cat n="nom">
      <cat-item tags="n.*"/>
    </def-cat>
    <def-cat n="nomp">
      <cat-item tags="np.ant"/>
    </def-cat>
    <def-cat n="nploc">
      <cat-item tags="np.loc"/>
      <cat-item tags="np.top.*"/>
    </def-cat>
    <def-cat n="detdefpl">
      <cat-item tags="det.def.mf.pl"/>
    </def-cat>
    <def-cat n="det">
      <cat-item tags="det.*"/>
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="le">
      <cat-item lemma="le" tags="det.*"/>
    </def-cat>
    <def-cat n="predet">
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="auxpp">
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbhaver.pp.*"/>
      <cat-item lemma="être" tags="vblex.pp.*"/>
    </def-cat>
    <def-cat n="adjec">
      <cat-item tags="adj.*"/>
      <cat-item tags="vblex.pp.*"/>
    </def-cat>
    <def-cat n="adj">
      <cat-item tags="adj.*"/>
    </def-cat>
    <def-cat n="neadv">
      <cat-item lemma="ne" tags="adv"/>
    </def-cat>
    <def-cat n="adv">
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
    </def-cat>
    <def-cat n="prep">
      <cat-item tags="pr"/>
    </def-cat>
    <def-cat n="enprep">
      <cat-item lemma="en" tags="pr"/>
    </def-cat>
    <def-cat n="deprep">
      <cat-item lemma="de" tags="pr"/>
    </def-cat>
    <def-cat n="apres">
      <cat-item lemma="après" tags="pr"/>
      <cat-item lemma="après" tags="adv"/>
    </def-cat>
    <def-cat n="pas">
      <cat-item lemma="pas" tags="adv"/>
    </def-cat>
    <def-cat n="train">
      <cat-item lemma="train" tags="n.*"/>
    </def-cat>
    <def-cat n="prnsubj">
      <cat-item lemma="je" tags="prn.tn.p1.mf.sg"/>
      <cat-item lemma="tu" tags="prn.tn.p2.mf.sg"/>
      <cat-item lemma="il" tags="prn.tn.p3.m.sg"/>
      <cat-item lemma="il" tags="prn.tn.p3.f.sg"/>
      <cat-item lemma="nous" tags="prn.tn.p1.mf.pl"/>
      <cat-item lemma="vous" tags="prn.tn.p2.mf.pl"/>
      <cat-item lemma="il" tags="prn.tn.p3.m.pl"/>
      <cat-item lemma="il" tags="prn.tn.p3.f.pl"/>
    </def-cat>
    <def-cat n="on">
      <cat-item lemma="on" tags="prn.pro.ref.p3.mf.sp"/>
    </def-cat>
    <def-cat n="prn">
      <cat-item tags="prn.tn.*"/>
      <cat-item tags="prn.itg.*"/>
      <cat-item tags="prn.pro.*"/>
      <cat-item tags="prn.enc.*"/>
    </def-cat>
    <def-cat n="rel">
      <cat-item tags="rel.*"/>
    </def-cat>
    <def-cat n="prnenc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>
    <def-cat n="prnproref3">
      <cat-item lemma="se" tags="prn.pro.ref.p3.mf.sp"/>
    </def-cat>
    <def-cat n="prnproref">
      <cat-item lemma="me" tags="prn.pro.p1.mf.sg"/>
      <cat-item lemma="te" tags="prn.pro.p2.mf.sg"/>
      <cat-item lemma="se" tags="prn.pro.ref.p3.mf.sp"/>
      <cat-item lemma="nous" tags="prn.pro.p1.mf.pl"/>
      <cat-item lemma="vous" tags="prn.pro.p2.mf.pl"/>
    </def-cat>
    <def-cat n="prnproobj">
      <cat-item lemma="me" tags="prn.pro.p1.mf.sg"/>
      <cat-item lemma="te" tags="prn.pro.p2.mf.sg"/>
      <cat-item lemma="lui" tags="prn.pro.p3.mf.sg"/>
      <cat-item lemma="nous" tags="prn.pro.p1.mf.pl"/>
      <cat-item lemma="se" tags="prn.pro.ref.p3.mf.sp"/>
      <cat-item lemma="vous" tags="prn.pro.p2.mf.pl"/>
      <cat-item lemma="leur" tags="prn.pro.p3.mf.pl"/>
      <cat-item lemma="le" tags="prn.pro.p3.mf.sg"/>
      <cat-item lemma="le" tags="prn.pro.p3.m.sg"/>
      <cat-item lemma="le" tags="prn.pro.p3.f.sg"/>
      <cat-item lemma="le" tags="prn.pro.p3.nt"/>
      <cat-item lemma="en" tags="prn.pro.adv"/>
      <cat-item lemma="y" tags="prn.pro.adv"/>
    </def-cat>
    <def-cat n="lui">
      <cat-item lemma="lui" tags="prn.pro.p3.mf.sg"/>
    </def-cat>
    <def-cat n="a_lui">
      <cat-item lemma="à lui" tags="adj.pos.m.sg"/>
    </def-cat>
    <def-cat n="a_nous">
      <cat-item lemma="à nous" tags="adj.pos.mf.sp"/>
    </def-cat>
    <def-cat n="a_vous">
      <cat-item lemma="à vous" tags="adj.pos.mf.sp"/>
    </def-cat>
    <def-cat n="nombreux">
      <cat-item lemma="nombreux" tags="adj.m.sp"/>
      <cat-item lemma="nombreux" tags="adj.f.pl"/>
    </def-cat>
    <def-cat n="vbser">
      <cat-item tags="vbser.*"/>
    </def-cat>
    <def-cat n="verb">
      <cat-item tags="vblex.*"/>
      <cat-item tags="vbser.*"/>
      <cat-item tags="vbhaver.*"/>
      <cat-item tags="vbmod.*"/>
    </def-cat>
    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbmod.inf"/>
    </def-cat>
    <def-cat n="pp">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbhaver.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
    </def-cat>
    <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbhaver.ger"/>
      <cat-item tags="vbmod.ger"/>
    </def-cat>
    <def-cat n="pretind">
      <cat-item tags="vblex.ifi.*"/>
      <cat-item tags="vbser.ifi.*"/>
      <cat-item tags="vbmod.ifi.*"/>
    </def-cat>
    <def-cat n="aller">
      <cat-item lemma="aller" tags="vblex.*"/>
    </def-cat>
    <def-cat n="lquest">
      <cat-item tags="lquest"/>
    </def-cat>
    <def-cat n="num">
      <cat-item tags="num"/>
      <cat-item tags="num.*"/>
    </def-cat>
    <def-cat n="xifra">
      <cat-item tags="num"/>
    </def-cat>
    <def-cat n="en">
      <cat-item lemma="en" tags="pr"/>
      <cat-item lemma="en" tags="prn.*"/>
    </def-cat>
    <def-cat n="a">
      <cat-item lemma="a" tags="pr"/>
    </def-cat>
    <def-cat n="que">
      <cat-item lemma="que" tags="cnjsub"/>
      <cat-item lemma="que" tags="rel.mf.sp"/>
      <cat-item lemma="que" tags="prn.itg.mf.sg"/>
    </def-cat>
    <def-cat n="pascomp">
      <cat-item tags="vbhaver.pri.*"/>
      <cat-item tags="vbhaver.prs.*"/>
      <cat-item tags="vbhaver.pii.*"/>
      <cat-item tags="vbhaver.pis.*"/>
      <cat-item tags="vbhaver.ifi.*"/>
      <cat-item tags="vbhaver.fts.*"/>
      <cat-item tags="vbhaver.fti.*"/>
      <cat-item tags="vbhaver.cni.*"/>
      <cat-item tags="vbser.pri.*"/>
      <cat-item tags="vbser.prs.*"/>
      <cat-item tags="vbser.pii.*"/>
      <cat-item tags="vbser.pis.*"/>
      <cat-item tags="vbser.ifi.*"/>
      <cat-item tags="vbser.fts.*"/>
      <cat-item tags="vbser.fti.*"/>
      <cat-item tags="vbser.cni.*"/>
    </def-cat>
    <def-cat n="verbconj">
      <cat-item tags="vblex.*.p1.*"/>
      <cat-item tags="vblex.*.p2.*"/>
      <cat-item tags="vblex.*.p3.*"/>
    </def-cat>
    <def-cat n="haber3p">
<!--	  <cat-item tags="vbhaver.pri.p3.sg"/> -->
      <cat-item tags="vbhaver.prs.p1.sg"/>
      <cat-item tags="vbhaver.prs.p3.sg"/>
      <cat-item tags="vbhaver.pii.p1.sg"/>
      <cat-item tags="vbhaver.pii.p3.sg"/>
      <cat-item tags="vbhaver.pis.p1.sg"/>
      <cat-item tags="vbhaver.pis.p3.sg"/>
      <cat-item tags="vbhaver.ifi.p3.sg"/>
      <cat-item tags="vbhaver.fts.p1.sg"/>
      <cat-item tags="vbhaver.fts.p3.sg"/>
      <cat-item tags="vbhaver.fti.p3.sg"/>
      <cat-item tags="vbhaver.cni.p1.sg"/>
      <cat-item tags="vbhaver.cni.p3.sg"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbhaver.ger"/>
    </def-cat>
    <def-cat n="pp_nohaver">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
    </def-cat>
    <def-cat n="appeler">
      <cat-item lemma="appeler" tags="vblex.pri.*"/>
      <cat-item lemma="appeler" tags="vblex.pii.*"/>
      <cat-item lemma="appeler" tags="vblex.fti.*"/>
    </def-cat>
    <def-cat n="verbospron">
      <cat-item lemma="assoir" tags="vblex.*"/>
      <cat-item lemma="taire" tags="vblex.*"/>
    </def-cat>
    <def-cat n="verbospron_pp">
      <cat-item lemma="taire" tags="vblex.pp.*"/>
      <cat-item lemma="assoir" tags="vblex.pp.*"/>
    </def-cat>
    <def-cat n="defense">
      <cat-item lemma="défense" tags="n.f.sg"/>
    </def-cat>
    <def-cat n="sent">
      <cat-item tags="sent"/>
    </def-cat>
    
  </section-def-cats>
  
  <section-def-attrs>
  
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
    </def-attr>
    <def-attr n="a_nomp">
      <attr-item tags="np.ant"/>
    </def-attr>
    <def-attr n="a_nploc">
      <attr-item tags="np.loc"/>
      <attr-item tags="np.top"/>
    </def-attr>
    <def-attr n="a_det">
      <attr-item tags="det.def"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.pos"/>
      <attr-item tags="predet"/>
    </def-attr>
    <def-attr n="a_predet">
      <attr-item tags="predet"/>
    </def-attr>
    <def-attr n="a_adjec">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.sup"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbser.pp"/>
    </def-attr>
    <def-attr n="a_adj">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.sup"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
    </def-attr>
    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="preadv"/>
    </def-attr>
    <def-attr n="a_prep">
      <attr-item tags="pr"/>
    </def-attr>
    <def-attr n="a_que">
      <attr-item tags="cnjsub"/>
      <attr-item tags="rel.mf.sp"/>
    </def-attr>
    <def-attr n="a_prn">
      <attr-item tags="prn.tn.p1"/>
      <attr-item tags="prn.tn.p2"/>
      <attr-item tags="prn.tn.p3"/>
      <attr-item tags="prn.tn"/>
      <attr-item tags="prn.tn.ref.p3"/>
      <attr-item tags="prn.tn.pos"/>
      <attr-item tags="prn.itg"/>
    </def-attr>
    <def-attr n="a_rel">
      <attr-item tags="rel"/>
    </def-attr>
    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/>
    </def-attr>
    <def-attr n="a_inf">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbser.inf"/>
      <attr-item tags="vbhaver.inf"/>
      <attr-item tags="vbmod.inf"/>
    </def-attr>
    <def-attr n="a_ger">
      <attr-item tags="vblex.ger"/>
      <attr-item tags="vbser.ger"/>
      <attr-item tags="vbhaver.ger"/>
      <attr-item tags="vbmod.ger"/>
    </def-attr>
    <def-attr n="a_pretind">
      <attr-item tags="vblex.ifi"/>
      <attr-item tags="vbser.ifi"/>
<!--	  <attr-item tags="vbhaver.ifi"/> -->
      <attr-item tags="vbmod.ifi"/>
    </def-attr>
    <def-attr n="a_lquest">
      <attr-item tags="lquest"/>
    </def-attr>
    <def-attr n="a_num">
      <attr-item tags="num"/>
    </def-attr>
    <def-attr n="a_xifra">
      <attr-item tags="num"/>
    </def-attr>
    <def-attr n="a_prnenc">
      <attr-item tags="prn.enc"/>
      <attr-item tags="prn.enc.ref"/>
      <attr-item tags="prn.enc.adv"/>
    </def-attr>
    <def-attr n="tipo_prn">
      <attr-item tags="enc"/>
      <attr-item tags="pro"/>
      <attr-item tags="tn"/>     
      <attr-item tags="itg"/>
    </def-attr>
    <def-attr n="tipoenc_pro">
      <attr-item tags="ref.p3.mf.sp"/>
      <attr-item tags="p1.mf.pl"/>
      <attr-item tags="p1.mf.sg"/>
      <attr-item tags="p2.mf.pl"/>
      <attr-item tags="p2.mf.sg"/>
      <attr-item tags="p3.f.pl"/>
      <attr-item tags="p3.f.sg"/>
      <attr-item tags="p3.mf.pl"/>
      <attr-item tags="p3.mf.sg"/>
      <attr-item tags="p3.m.pl"/>
      <attr-item tags="p3.m.sg"/>
      <attr-item tags="p3.nt"/>
      <attr-item tags="mf.sg"/>
      <attr-item tags="adv"/>
    </def-attr>
    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>
    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>
    <def-attr n="persona">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>
    <def-attr n="temps">
      <attr-item tags="inf"/>
      <attr-item tags="ger"/>
      <attr-item tags="pp"/>
      <attr-item tags="pri"/>
      <attr-item tags="ifi"/>
      <attr-item tags="pii"/>
      <attr-item tags="fti"/>
      <attr-item tags="cni"/>
      <attr-item tags="prs"/>
      <attr-item tags="pis"/>
      <attr-item tags="fts"/>
      <attr-item tags="imp"/>
    </def-attr>
    <def-attr n="verbototal">
      <attr-item tags="vblex.pri.p1.sg"/>
      <attr-item tags="vblex.pri.p3.sg"/>
      <attr-item tags="vblex.pri.p2.sg"/>
      <attr-item tags="vblex.pri.p3.pl"/>
      <attr-item tags="vblex.prs.p1.sg"/>
      <attr-item tags="vblex.prs.p2.sg"/>
      <attr-item tags="vblex.prs.p3.sg"/>
      <attr-item tags="vblex.prs.p3.pl"/>
    </def-attr>
    
  </section-def-attrs>
  
  <section-def-vars>
  
    <def-var n="uno"/>
    <def-var n="genero"/>
    <def-var n="numero"/>
    <def-var n="concDet"/>
    <def-var n="concAdj"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="interrogativa"/>
    <def-var n="exclamativa"/>
    <def-var n="auxg"/>
    <def-var n="auxn"/>
    <def-var n="aux"/>
  </section-def-vars>
  
  <section-def-lists>
  
    <def-list n="mois">
      <list-item v="janvier"/>
      <list-item v="février"/>
      <list-item v="mars"/>
      <list-item v="avril"/>
      <list-item v="mai"/>
      <list-item v="juin"/>
      <list-item v="juillet"/>
      <list-item v="août"/>
      <list-item v="septembre"/>
      <list-item v="octobre"/>
      <list-item v="novembre"/>
      <list-item v="décembre"/>
    </def-list>
    <def-list n="vbestat">
      <list-item v="aller"/>
      <list-item v="venir"/>
      <list-item v="arriver"/>
      <list-item v="partir"/>
      <list-item v="naître"/>
      <list-item v="mourir"/>
      <list-item v="descendre"/>
      <list-item v="monter"/>
      <list-item v="entrer"/>
      <list-item v="sortir"/>
      <list-item v="tomber"/>
      <list-item v="retourner"/>
      <list-item v="passer"/>
      <list-item v="rester"/>
      <list-item v="devenir"/>
      <list-item v="revenir"/>
    </def-list>
    <def-list n="pays">
      <list-item v="Europe"/>
      <list-item v="Asie"/>
      <list-item v="Afrique"/>
      <list-item v="Amérique"/>
      <list-item v="Océanie"/>
      <list-item v="Australie"/>
      <list-item v="Nouvelle Zélande"/>
      <list-item v="Portugal"/>
      <list-item v="Espagne"/>
      <list-item v="Catalogne"/>
      <list-item v="Valence"/>
      <list-item v="Castille"/>
      <list-item v="Andalousie"/>
      <list-item v="Andorre"/>
      <list-item v="France"/>
      <list-item v="Champagne"/>
      <list-item v="Bretagne"/>
      <list-item v="Normandie"/>
      <list-item v="Auvergne"/>
      <list-item v="Provence"/>
      <list-item v="Angleterre"/>
      <list-item v="Écosse"/>
      <list-item v="Irlande"/>
      <list-item v="Belgique"/>
      <list-item v="Wallonie"/>
      <list-item v="Flandre"/>
      <list-item v="Hollande"/>
      <list-item v="Alemagne"/>
      <list-item v="Danemark"/>
      <list-item v="Islande"/>
      <list-item v="Norvège"/>
      <list-item v="Suède"/>
      <list-item v="Finlande"/>
      <list-item v="Russie"/>
      <list-item v="Tchétchénie"/>
      <list-item v="Tchouvachie"/>
      <list-item v="Tatarstan"/>
      <list-item v="Bashkortostan"/>
      <list-item v="Yakoutie"/>
      <list-item v="Estonie"/>
      <list-item v="Létonie"/>
      <list-item v="Lithuanie"/>
      <list-item v="Pologne"/>
      <list-item v="Tchécoslovaquie"/>
      <list-item v="Tchéquie"/>
      <list-item v="Slovakie"/>
      <list-item v="Hongrie"/>
      <list-item v="Autriche"/>
      <list-item v="Suisse"/>
      <list-item v="Italie"/>
      <list-item v="Sardeigne"/>
      <list-item v="Sicile"/>
      <list-item v="Slovénie"/>
      <list-item v="Croatie"/>
      <list-item v="Serbie"/>
      <list-item v="Bosnie"/>
      <list-item v="Monténegro"/>
      <list-item v="Macédoine"/>
      <list-item v="Roumanie"/>
      <list-item v="Bulgarie"/>
      <list-item v="Grèce"/>
      <list-item v="Ukraine"/>
      <list-item v="Biélorussie"/>
      <list-item v="Moldavie"/>
      <list-item v="Turquie"/>
      <list-item v="Syrie"/>
      <list-item v="Kurdistan"/>
      <list-item v="Arménie"/>
      <list-item v="Géorgie"/>
      <list-item v="Azerbaïdjan"/>
      <list-item v="Kazakhstan"/>
      <list-item v="Turkménistan"/>
      <list-item v="Ouzbékistan"/>
      <list-item v="Kirgizistan"/>
      <list-item v="Tadjikistan"/>
      <list-item v="Iran"/>
      <list-item v="Iraq"/>
      <list-item v="Irak"/>
      <list-item v="Pakistan"/>
      <list-item v="Inde"/>
      <list-item v="Marroc"/>
      <list-item v="Algérie"/>
      <list-item v="Tunisie"/>
      <list-item v="Lybie"/>
      <list-item v="Égypte"/>
      <list-item v="Arabie"/>
      <list-item v="Canada"/>
      <list-item v="Québec"/>
      <list-item v="Mexique"/>
      <list-item v="Panama"/>
      <list-item v="Colombie"/>
      <list-item v="Vénézuéla"/>
      <list-item v="Brésil"/>
      <list-item v="Équateur"/>
      <list-item v="Pérou"/>
      <list-item v="Chile"/>
      <list-item v="Argentine"/>
      <list-item v="Bolivie"/>
      <list-item v="Paraguay"/>
      <list-item v="Uruguay"/>
    </def-list>
  </section-def-lists>
  
  <section-def-macros>

  <def-macro n="f_prn_prn" npar="2">
<!-- analiza els dos pronoms (típicament CD i CI) i, si cal, en canvia l'ordre -->
     <choose>
<!-- opcio valenciana
      <when>
        <test>
          <and>
            <equal><clip pos="1" side="sl" part="lem"/><lit v="le"/></equal>
            <equal><clip pos="2" side="sl" part="lem"/><lit v="lui"/></equal>
         </and>
        </test>
        <let><clip pos="1" side="tl" part="whole"/><clip pos="2" side="tl" part="whole"/></let>
        <let><clip pos="2" side="tl" part="whole"/><clip pos="1" side="tl" part="whole"/></let>
      </when>
-->
<!-- opcio principatina
-->
      <when>
        <test>
          <and>
            <equal><clip pos="1" side="sl" part="lem"/><lit v="le"/></equal>
            <equal><clip pos="1" side="sl" part="gen"/><lit-tag v="f"/></equal>
            <equal><clip pos="2" side="sl" part="lem"/><lit v="lui"/></equal>
         </and>
        </test>
        <let><clip pos="2" side="tl" part="whole"/><concat><lit v="hi"/><lit-tag v="prn.pro.adv"/></concat></let>
      </when>
      <when>
        <test>
          <and>
            <equal><clip pos="1" side="sl" part="lem"/><lit v="le"/></equal>
            <equal><clip pos="1" side="sl" part="gen"/><lit-tag v="m"/></equal>
            <equal><clip pos="2" side="sl" part="lem"/><lit v="lui"/></equal>
         </and>
        </test>
        <let><clip pos="2" side="tl" part="whole"/><concat><lit v="hi"/><lit-tag v="prn.pro.adv"/></concat></let>
      </when>
      <when>
        <test>
          <and>
            <equal><clip pos="1" side="sl" part="lem"/><lit v="le"/></equal>
            <equal><clip pos="1" side="sl" part="gen"/><lit-tag v="nt"/></equal>
            <equal><clip pos="2" side="sl" part="lem"/><lit v="lui"/></equal>
         </and>
        </test>
        <let><var n="aux"/><clip pos="1" side="tl" part="whole"/></let>
        <let><clip pos="1" side="tl" part="whole"/><clip pos="2" side="tl" part="whole"/></let>
        <let><clip pos="2" side="tl" part="whole"/><var n="aux"/></let>
      </when>
    </choose>
  </def-macro>
 
  <def-macro n="f_ifi1" npar="1">
     <choose>
      <when>
        <test><equal><clip pos="1" side="sl" part="temps"/><lit-tag v="ifi"/></equal></test>
        <let><clip pos="1" side="tl" part="whole"/>
             <concat><get-case-from pos="1"><lit v="anar"/></get-case-from><lit-tag v="vblex.pri"/><clip pos="1" side="tl" part="persona"/><clip pos="1" side="tl" part="nbr"/>
                <lit v="$ ^"/><clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/><lit-tag v="inf"/>
                <clip pos="1" side="tl" part="lemq"/></concat></let>
      </when>
      <otherwise>
        <let><clip pos="1" side="tl" part="whole"/>
             <concat><clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="tags"/>
                <clip pos="1" side="tl" part="lemq"/></concat></let>
      </otherwise>
    </choose>
  </def-macro>
 
    <def-macro n="f_bcond" npar="2">
<!--Para mirar si el blanco contiene o no formato, y enviarlo sólo si tiene formato (para reglas en las que se elimine una o más palabras) -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <b pos="1"/>
                <lit v=" "/>
              </equal>
            </not>
          </test>
          <out>
            <b pos="1"/>
          </out>
        </when>
      </choose>
    </def-macro>
    
     
    <def-macro n="test_pr_i_verb" npar="2">
<!--Para comprobar según la preposición y el verbo, qué traducción hay que enviar -->
      <choose>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="venir"/>
              </equal>
	       <equal>
                <clip pos="2" side="tl" part="lem"/>
                <lit v="de"/>
              </equal>
            </and>
          </test>
	  <let>
	   <clip pos="1" side="tl" part="lem"/>
           <lit v="acabar"/>
	  </let>                    
        </when>
      </choose>
    </def-macro>
    
    
    <def-macro n="f_concord_pedac" npar="1">
<!--Pedaç totalment ad-hoc per solucionar problmes amb l'assignació del gènere i nombre a heureux, joyeux > feliç -->
      <choose>
        <when>
          <test>
            <and>
              <equal><clip pos="1" side="tl" part="lem"/><lit v="feliç"/></equal>
              <equal><clip pos="1" side="tl" part="gen"/><lit-tag v="m"/></equal>
              <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></equal>
            </and>
          </test>
          <let><clip pos="1" side="tl" part="gen"/><lit-tag v="mf"/></let>
        </when>
      </choose>
    </def-macro>
    
    
    <def-macro n="f_concord1" npar="1">
      <choose>
<!--To determine value of variables of gender and
                 number and propagate to other rules.  Variables are
                 not used again in this rule -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- If word has GD or ND, we try to assign the
              gender or number of the previous rule. If there is no
              value for the gender or number variable from previous
              rules, gender will be masculine and number singular.-->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genero"/>
                  <lit-tag v="f"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="f"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="numero"/>
                  <lit-tag v="pl"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="pl"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sg"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
    </def-macro>
    
    <def-macro n="f_concord2" npar="2">
      <choose>
        <when>
          <test>
<!-- do the main and second parameter gender agree?-->
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
<!-- do the main and second parameter number agree?-->
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
<!-- there is gender and number agreement-->
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
<!-- there isn't gender and number agreement-->
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
<!-- Propagate the main parameter gender if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- Propagate the main parameter number if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- Which is the rule general gender? -->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
<!-- Which is the rule general number? -->
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Determine gender and number value if they are undetermined -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="2"/></call-macro>
    </def-macro>
    
    <def-macro n="f_concord3" npar="3">
      <choose>
<!-- Look whether in source language there is concordance between first and second element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Look whether in source language there is concordance between second and third element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Propagate the main parameter gender if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Propagate the main parameter number if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Determine the rule general gender. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="3" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Determine the rule general number. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Assign values to GD and ND -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="2"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="3"/></call-macro>
    </def-macro>
    
    <def-macro n="f_concord4" npar="4">
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concTercero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concTercero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <call-macro n="f_concord_pedac"><with-param pos="1"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="2"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="3"/></call-macro>
      <call-macro n="f_concord_pedac"><with-param pos="4"/></call-macro>
    </def-macro>
  </section-def-macros>
  
  <section-rules>
<!--regles de concordança-->
    <rule comment="REGLA: DETERMINANT">
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM">
      <pattern>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: AUXPP">
      <pattern>
        <pattern-item n="auxpp"/>
      </pattern>
      <action>
        <!-- haver# de, etc. no té formes -->
        <let><clip pos="1" side="tl" part="gen"/><lit-tag v="m"/></let>
        <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></let>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
 
    <rule comment="REGLA: ADJECTIU">
      <pattern>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test><and><equal><clip pos="1" side="tl" part="a_adjec"/><lit-tag v="vblex.pp"/></equal>
                       <equal><clip pos="1" side="sl" part="gen"/><lit-tag v="mf"/></equal>
                       <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="sp"/></equal></and></test>
            <let><clip pos="1" side="tl" part="gen"/><lit-tag v="GD"/></let>
            <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="ND"/></let></when>
        </choose>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_adjec"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
     <rule>
<!--REGLA: prep + lui -->
      <pattern>
        <pattern-item n="prep"/>
	<pattern-item n="lui"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
            <b pos="1"/>
          <lu>
            <lit v="ell"/>
            <lit-tag v="prn.tn.p3.m.sg"/>
          </lu>
        </out>
      </action>
  </rule>
    

    <rule>
<!-- REGLA: PRONOM -->
<!--Special case, macro f_concord1 
is not applicable because gender and number cannot be taken from previous rules -->
      <pattern>
        <pattern-item n="prn"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="GD"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: NUMERAL-->
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: RELATIF-->
      <pattern>
        <pattern-item n="rel"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DETERMINANT NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: NOM ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
	    <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: ADJECTIU NOM -->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="1er"/>
	        </equal> 
                <in caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <list n="mois"/>
                </in>
              </and>
            </test>
            <out>
              <lu>
                <lit v="1"/>
                <lit-tag v="num"/>
              </lu>
              <b pos="1"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="tags"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
	    <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DET NOM ADJECTIU ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
	    <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: NOM ADJECTIU ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
	    <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DET ADJECTIU NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
	        <equal>
	       	   <clip pos="2" side="sl" part="lem"/>
		   <lit v="1er"/>
	        </equal> 
                <in caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <list n="mois"/>
                </in>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <lit v="1"/>
                <lit-tag v="num"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>            
	        <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_adjec"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: PREDET DET NOM-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: PREDET DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DETERMINANT ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: ADJECTIU NOM ADJECTIU-->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>            
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DET ADJECTIU NOM ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: NOM ADVERBI ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DET NOM ADVERBI ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
	    <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DET ADVERBI NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adv"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: NUMERAL NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="2" side="sl" part="lem"/>
                <list n="mois"/>
              </in>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: NUMERAL ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: NUMERAL NOM ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
       	    <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: NUMERAL ADJECTIU NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>    
	    <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: DET NUMERAL NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <list n="mois"/>
              </in>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
   <rule>
<!--REGLA: NUMERAL NOM NUM (20 novembre 1998: 20 de novembre de 1998)-->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="2" side="sl" part="lem"/>
                <list n="mois"/>
              </in>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tags"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!--REGLA: DET NUMERAL NOM NUM (le 20 novembre 1998: el 20 de novembre de 1998)-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <list n="mois"/>
              </in>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="3"/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DET NOM DET ADVERBI ADJECTIU: la fille la plus jolie : la noia més maca -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="5"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
	    <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_adjec"/>
            <clip pos="5" side="tl" part="gen"/>
            <clip pos="5" side="tl" part="nbr"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
<!--fi regles de concordança-->
<!--regles per a eliminar el partitiu-->
    <rule>
<!-- REGLA: SENT PREP DET NOM (sent Des enfants : sent Alguns xiquets) -->
      <pattern>
        <pattern-item n="sent"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <get-case-from pos="2">
              <lit v="algun"/>
            </get-case-from>
            <lit-tag v="det.ind"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="tags"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DE NOMBREUX NOM (de nombreux enfants : molts xiquets) -->
      <pattern>
        <pattern-item n="deprep"/>
        <pattern-item n="nombreux"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="molt"/>
            </get-case-from>
            <lit-tag v="adj"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: APRES DE NOMBREUX NOM (après de nombreuses années :n després de molts xiquets) -->
      <pattern>
        <pattern-item n="apres"/>
        <pattern-item n="deprep"/>
        <pattern-item n="nombreux"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="4"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <lit v="molt"/>
            <lit-tag v="adj"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="tags"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: DE NOMBREUX ADJ NOM (de nombreux petits enfants : molts petits xiquets) -->
      <pattern>
        <pattern-item n="deprep"/>
        <pattern-item n="nombreux"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="4"/>
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="molt"/>
            </get-case-from>
            <lit-tag v="adj"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="tags"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="tags"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PREP PREP DET (avec des: amb) -->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    
    <rule>
<!-- REGLA: verb + de +  VERB PREP DET (venir de avoir des: acabar de tenir)-->
      <pattern> 
        <pattern-item n="verb"/>
        <pattern-item n="prep"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
      <call-macro n="test_pr_i_verb">
        <with-param pos="1"/>
        <with-param pos="2"/>
      </call-macro>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="3" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
	  <out>
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
	  <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>	
	<out>
	  <lu>   
	    <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
	  <b pos="1"/>
	  <lu>   
	    <clip pos="2" side="tl" part="whole"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
     </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA: aller +  INF (aller manger : anar a menjar)-->
<!-- difícil de dir si és "anar a" o futur, però segur que cal canviar l'estructura -->
      <pattern> 
        <pattern-item n="aller"/>
        <pattern-item n="inf"/>
     </pattern>	
      <action>
        <out>
	  <lu>   
	    <clip pos="1" side="tl" part="lemh"/>
	    <clip pos="1" side="tl" part="tags"/>
	    <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b/>
          <lu>
            <lit v="a"/>
            <lit-tag v="pr"/>
          </lu>
	  <b pos="1"/>
	  <lu>   
	    <clip pos="2" side="tl" part="lemh"/>
	    <clip pos="2" side="tl" part="tags"/>
	    <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: aller + PRO+ INF (aller en manger : anar a menjar-ne)-->
<!-- difícil de dir si és "anar a" o futur, però segur que cal canviar l'estructura -->
      <pattern> 
        <pattern-item n="aller"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="inf"/>
     </pattern>	
      <action>
        <out>
	  <lu>   
	    <clip pos="1" side="tl" part="lemh"/>
	    <clip pos="1" side="tl" part="tags"/>
	    <clip pos="1" side="tl" part="lemq"/>
          </lu>
	  <b pos="1"/>
          <lu>
            <lit v="a"/>
            <lit-tag v="pr"/>
          </lu>
	  <b pos="2"/>
          <mlu>
	    <lu>   
	      <clip pos="3" side="tl" part="lemh"/>
	      <clip pos="3" side="tl" part="tags"/>
	      <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <lit-tag v="prn.enc"/>
              <clip pos="2" side="tl" part="tipoenc_pro"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: verb +  VERB PREP DET (aller avoir des: tindrà)-->
      <pattern> 
        <pattern-item n="verb"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="2" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
          <lu>
	   <get-case-from pos="1">
            <clip pos="2" side="tl" part="lemh"/>
	   </get-case-from> 
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>
	<out>
	  <lu>   
	    <clip pos="1" side="tl" part="whole"/>
          </lu>
	  <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
     </choose>	
      </action>
    </rule>
    <rule>
<!-- REGLA:VERB PREP DET (avoir des: tenir)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>

    <rule>
<!-- REGLA: verb de + VERB que PREP DET (venir d'avoir que des: acabar de tenir més que)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prep"/>	
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
      <call-macro n="test_pr_i_verb">
        <with-param pos="1"/>
        <with-param pos="2"/>
      </call-macro>	
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="3" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
	    <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
	  <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>            
	    <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
	  <lu>   
	    <clip pos="2" side="tl" part="whole"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>

    
    <rule>
<!-- REGLA: verb + VERB que PREP DET (aller avoir que des: tenir més que)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="2" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>  
	  <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:VERB que PREP DET (avoir que des: tenir més que)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    
     <rule>
<!-- REGLA: verb de + VERB toujours PREP DET (venir d'avoir toujours des: acabar de tenir sempre)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prep"/>	
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <call-macro n="test_pr_i_verb">
        <with-param pos="1"/>
        <with-param pos="2"/>
      </call-macro>	
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="3" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
	    <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
	  <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
	    <lit-tag v="ger"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
	  <lu>   
	    <clip pos="2" side="tl" part="whole"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>

    
    <rule>
<!-- REGLA: verb + VERB toujours PREP DET (aller avoir toujours des: tenir sempre)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="2" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>  
	  <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    
    
    
    <rule>
<!-- REGLA:VERB adv PREP DET (avoir toujours des: tenir encara)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>


    
     <rule>
<!-- REGLA: verb de + VERB toujours PREP DET (venir d'avoir toujours des: acabar de tenir sempre)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prep"/>	
        <pattern-item n="verb"/>
        <pattern-item n="adv"/> 
	<pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <call-macro n="test_pr_i_verb">
        <with-param pos="1"/>
        <with-param pos="2"/>
      </call-macro>	
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="3" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
	    <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
	  <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
	    <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
	  <lu>   
	    <clip pos="2" side="tl" part="whole"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>

    
    <rule>
<!-- REGLA: verb + VERB aujourd'hui encore PREP DET (aller avoir ajourd'hui encore des: tenir hui encara)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>      
	<pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="1" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="2" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>  
	  <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    
    <rule>
<!-- REGLA:VERB adv adv PREP DET (avoir auhjourd'hui encore des: tenir avui encara-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN VERB PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN VERBSER PP PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="vbser"/>
        <pattern-item n="pp"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <list n="vbestat"/>
              </in>
            </test>
            <out>
              <lu>
                <get-case-from pos="1">
                  <lit v="haver"/>
                </get-case-from>
                <lit-tag v="vbhaver"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN NEADV VERB que PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="neadv"/>
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN ADV VERB pas PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN ADV VERB pas adv PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN VERB adv PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN adv VERB PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN VERB adv adv PREP DET -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
 <rule>
<!-- REGLA:PRN verb + VERB PREP DET je vais faire des voyages: faré viatges -->
      <pattern>
        <pattern-item n="prnsubj"/>
	<pattern-item n="verb"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern> 
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="2" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="3" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
          <lu>
	   <get-case-from pos="1">
            <clip pos="3" side="tl" part="lemh"/>
	   </get-case-from> 
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>
	<out>
	  <lu>   
	    <clip pos="2" side="tl" part="whole"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
     </choose>	
      </action>
    </rule>
    
    
    <rule>
<!-- REGLA:PRN NEADV verb + VERB que PREP DET je ne vais faire que des voyages: no faré més que viatges-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="neadv"/>
        <pattern-item n="verb"/>
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
       <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="4" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <clip pos="4" side="tl" part="temps"/>
            <clip pos="4" side="tl" part="persona"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN ADV VERB pas verb PREP DET je ne vais pas faire des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="5" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <clip pos="5" side="tl" part="temps"/>
            <clip pos="5" side="tl" part="persona"/>
            <clip pos="5" side="tl" part="gen"/>
            <clip pos="5" side="tl" part="nbr"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN ADV VERB pas verb adv PREP DET je ne vais pas faire toujours des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="5" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/> 
	  <lu>
	   <clip pos="6" side="tl" part="whole"/>
	  </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <clip pos="5" side="tl" part="temps"/>
            <clip pos="5" side="tl" part="persona"/>
            <clip pos="5" side="tl" part="gen"/>
            <clip pos="5" side="tl" part="nbr"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/> 
	  <lu>
	   <clip pos="6" side="tl" part="whole"/>
	  </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
     <rule>
<!-- REGLA:PRN ADV VERB pas verb adv PREP DET je ne vais pas toujours faire des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
	 <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="6" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <clip pos="6" side="tl" part="lemh"/>
            <clip pos="6" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="6" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/> 
	  <lu>
	   <clip pos="5" side="tl" part="whole"/>
	  </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
          <lu>
            <clip pos="6" side="tl" part="lemh"/>
            <clip pos="6" side="tl" part="a_verb"/>
            <clip pos="6" side="tl" part="temps"/>
            <clip pos="6" side="tl" part="persona"/>
            <clip pos="6" side="tl" part="gen"/>
            <clip pos="6" side="tl" part="nbr"/>
            <clip pos="6" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/> 
	  <lu>
	   <clip pos="5" side="tl" part="whole"/>
	  </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN verb VERB adv PREP DET je vais faire encore des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
	<pattern-item n="verb"/>	
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="2" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="3" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
          <lu>
	  <get-case-from pos="1">
            <clip pos="3" side="tl" part="lemh"/>  
	  </get-case-from>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>  
	  <get-case-from pos="1">
            <clip pos="2" side="tl" part="lem"/>
	  </get-case-from>  
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>  
	  <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN adv verb VERB PREP DET je aujourd'hui vais faire des voyages -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="4" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
	 <lu>
	   <get-case-from pos="1">
            <clip pos="2" side="tl" part="lemh"/>
	   </get-case-from> 
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>
	<out>
	 <lu>
	   <get-case-from pos="1">
            <clip pos="2" side="tl" part="lemh"/>
	   </get-case-from> 
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
	  <b pos="2"/>
	  <lu>   
	    <clip pos="3" side="tl" part="whole"/>
          </lu>
	  <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <clip pos="4" side="tl" part="temps"/>
            <clip pos="4" side="tl" part="persona"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
     </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN VERB adv adv PREP DET il va faire aujourd'hui encore des voyages -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="verb"/>
	<pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
 <action>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="2" side="sl" part="lem"/>
		   <lit v="aller"/>
	        </equal> 
		<equal>
	           <clip pos="3" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
          <lu> 
	    <get-case-from pos="1">
              <clip pos="3" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
          <get-case-from pos="1">
            <clip pos="2" side="tl" part="lem"/>
          </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>  
	  <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
 
 <rule>
<!-- REGLA:PRN verb + prep + VERB PREP DET je viens de faire des voyages: acabe de fer viatges -->
      <pattern>
        <pattern-item n="prnsubj"/>
	<pattern-item n="verb"/>
	<pattern-item n="prep"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern> 
      <action>
      <call-macro n="test_pr_i_verb">
        <with-param pos="2"/>
        <with-param pos="3"/>
      </call-macro>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="2" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="4" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
	  <out>
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>	
	<out>
	  <lu>   
	    <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
	  <b pos="2"/>
	  <lu>   
	    <clip pos="3" side="tl" part="whole"/>
          </lu>
	  <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <clip pos="4" side="tl" part="temps"/>
            <clip pos="4" side="tl" part="persona"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
     </choose>	
      </action>
    </rule>
    
    
    <rule>
<!-- REGLA:PRN NEADV verb + de + VERB que PREP DET je ne viens de faire que des voyages: no acabe de fer més que viatges-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="neadv"/>
        <pattern-item n="verb"/>
	<pattern-item n="prep"/>
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
      <call-macro n="test_pr_i_verb">
        <with-param pos="3"/>
        <with-param pos="4"/>
      </call-macro>
       <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="5" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
     	    <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
	  <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
          <b pos="5"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="6" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
	  <lu>
             <clip pos="4" side="tl" part="whole"/>
	  </lu> 
	  <b/> 
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <clip pos="5" side="tl" part="temps"/>
            <clip pos="5" side="tl" part="persona"/>
            <clip pos="5" side="tl" part="gen"/>
            <clip pos="5" side="tl" part="nbr"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
          <b pos="5"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="6" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN ADV VERB pas verb PREP DET je ne vais pas faire des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
        <pattern-item n="prep"/>	
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
      <call-macro n="test_pr_i_verb">
        <with-param pos="3"/>
        <with-param pos="5"/>
      </call-macro>
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="6" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
     	    <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
	  <b pos="3"/>
          <lu>
            <clip pos="6" side="tl" part="lemh"/>
            <clip pos="6" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="6" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
	  <lu>
             <clip pos="5" side="tl" part="whole"/>
	  </lu>
	  <b pos="5"/>
          <lu>
            <clip pos="6" side="tl" part="lemh"/>
            <clip pos="6" side="tl" part="a_verb"/>
            <clip pos="6" side="tl" part="temps"/>
            <clip pos="6" side="tl" part="persona"/>
            <clip pos="6" side="tl" part="gen"/>
            <clip pos="6" side="tl" part="nbr"/>
            <clip pos="6" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN ADV VERB pas verb adv PREP DET je ne viens pas de faire toujours des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
	<pattern-item n="prep"/>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
      <call-macro n="test_pr_i_verb">
        <with-param pos="3"/>
        <with-param pos="5"/>
      </call-macro>
          <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="6" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
     	    <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
	  <b pos="3"/>
          <lu>
            <clip pos="6" side="tl" part="lemh"/>
            <clip pos="6" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="6" side="tl" part="lemq"/>
          </lu>
	  <b pos="4"/>
          <lu>
            <clip pos="7" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
	  <lu>
             <clip pos="5" side="tl" part="whole"/>
	  </lu>
	  <b pos="5"/>
          <lu>
            <clip pos="6" side="tl" part="lemh"/>
            <clip pos="6" side="tl" part="a_verb"/>
            <clip pos="6" side="tl" part="temps"/>
            <clip pos="6" side="tl" part="persona"/>
            <clip pos="6" side="tl" part="gen"/>
            <clip pos="6" side="tl" part="nbr"/>
            <clip pos="6" side="tl" part="lemq"/>
          </lu>
	  <b pos="5"/>
          <lu>
            <clip pos="7" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>       
    </rule>
     <rule>
<!-- REGLA:PRN ADV VERB pas adv prep verb PREP DET je ne viens pas toujours de faire des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
        <pattern-item n="adv"/>
	<pattern-item n="prep"/> 
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
      <action>
         <call-macro n="test_pr_i_verb">
        <with-param pos="3"/>
        <with-param pos="6"/>
      </call-macro>
          <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="7" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
     	    <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
	  <b pos="3"/>
          <lu>
            <clip pos="7" side="tl" part="lemh"/>
            <clip pos="7" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="7" side="tl" part="lemq"/>
          </lu>
	  <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
	  <lu>
             <clip pos="5" side="tl" part="whole"/>
	  </lu>
	  <b pos="5"/>
	  <lu>
             <clip pos="6" side="tl" part="whole"/>
	  </lu>
	  <b pos="6"/>
          <lu>
            <clip pos="7" side="tl" part="lemh"/>
            <clip pos="7" side="tl" part="a_verb"/>
            <clip pos="7" side="tl" part="temps"/>
            <clip pos="7" side="tl" part="persona"/>
            <clip pos="7" side="tl" part="gen"/>
            <clip pos="7" side="tl" part="nbr"/>
            <clip pos="7" side="tl" part="lemq"/>
          </lu>
	  <b pos="7"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>       
    </rule>
    
    <rule>
<!-- REGLA:PRN verb + de +  VERB adv PREP DET je viens de faire encore des voyages-->
      <pattern>
        <pattern-item n="prnsubj"/>
	<pattern-item n="verb"/>	
	<pattern-item n="prep"/>
        <pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
        <action>
        <call-macro n="test_pr_i_verb">
        <with-param pos="2"/>
        <with-param pos="3"/>
      </call-macro>	
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="2" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="4" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
	    <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
	    <lit-tag v="ger"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
	  <lu>   
	    <clip pos="3" side="tl" part="whole"/>
          </lu>
	  <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <clip pos="4" side="tl" part="temps"/>
            <clip pos="4" side="tl" part="persona"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
    
    <rule>
<!-- REGLA:PRN adv verb VERB PREP DET je aujourd'hui viens de faire des voyages -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
	<pattern-item n="prep"/>
        <pattern-item n="verb"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
  <action>
      <call-macro n="test_pr_i_verb">
        <with-param pos="3"/>
        <with-param pos="4"/>
      </call-macro>
       <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="3" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="5" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
         <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
     	    <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
	  <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
	 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/> 
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="persona"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>  
	  <b pos="3"/>
	  <lu>
             <clip pos="4" side="tl" part="whole"/>
	  </lu>
	  <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <clip pos="5" side="tl" part="temps"/>
            <clip pos="5" side="tl" part="persona"/>
            <clip pos="5" side="tl" part="gen"/>
            <clip pos="5" side="tl" part="nbr"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>    
    </rule>
    
    <rule>
<!-- REGLA:PRN VERB de verb adv adv PREP DET il vient de faire aujourd'hui encore des voyages -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="verb"/>
	<pattern-item n="prep"/>
	<pattern-item n="verb"/>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="detdefpl"/>
      </pattern>
        <action>
        <call-macro n="test_pr_i_verb">
        <with-param pos="2"/>
        <with-param pos="3"/>
      </call-macro>	
        <choose>
	  <when>
	    <test>
	      <and>
	        <equal>
	       	   <clip pos="2" side="sl" part="lem"/>
		   <lit v="être"/>
	        </equal> 
		<equal>
	           <clip pos="4" side="sl" part="temps"/>
		   <lit-tag v="inf"/>
	        </equal>
	      </and>
	    </test>
        <out>
	  <lu>
            <lit v="estar"/>
	    <lit-tag v="vblex"/>
	    <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
	  <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
	    <lit-tag v="ger"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
          <b pos="5"/>
          <lu>
            <clip pos="6" side="tl" part="whole"/>
          </lu>
        </out>
	</when>
	<otherwise>
        <out>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="persona"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
	  <lu>   
	    <clip pos="3" side="tl" part="whole"/>
          </lu>
	  <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <clip pos="4" side="tl" part="temps"/>
            <clip pos="4" side="tl" part="persona"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
          <b pos="4"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
          <b pos="5"/>
          <lu>
            <clip pos="6" side="tl" part="whole"/>
          </lu>
        </out>
      </otherwise>
      </choose>	
      </action>
    </rule>
        
   
<!--fi regles per a eliminar el partitiu-->
<!--<rule>
 REGLA: Passé composé/perifràstic -->
<!-- Per traduir "ai fait" per "vaig fer" 
      <pattern>
	<pattern-item n="pascomp"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
	<out>
	  <lu>
	    <get-case-from pos="1">            
	      <lit v="anar"/>
	    </get-case-from>
	    <lit-tag v="vblex"/>
	    <clip pos="1" side="tl" part="temps"/>
	    <clip pos="1" side="tl" part="persona"/>
	    <clip pos="1" side="tl" part="nbr"/>
	  </lu>  
	   <b pos="1"/> 
	  <lu>  
	    <clip pos="2" side="tl" part="lem"/>
	    <clip pos="2" side="tl" part="a_verb"/>                  
	    <lit-tag v="inf"/>                  
	    <clip pos="2" side="tl" part="lemq"/>                  
	  </lu>  
	</out>  
      </action>
   </rule>


   <rule> 
   REGLA: Passé composé/perifràstic -->
<!-- Per traduir "ai fait" per "vaig fer" 
      <pattern>
	<pattern-item n="pascomp"/>
	<pattern-item n="adv"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
	<out>
	  <lu>
	    <get-case-from pos="1">            
	      <lit v="anar"/>
	    </get-case-from>
	    <lit-tag v="vblex"/>
	    <clip pos="1" side="tl" part="temps"/>
	    <clip pos="1" side="tl" part="persona"/>
	    <clip pos="1" side="tl" part="nbr"/>
	  </lu>  
	   <b pos="1"/> 
	   <lu>
	   <clip pos="2" side="tl" part="whole"/>
	   </lu>  
	   <b pos="2"/> 
	  <lu>  
	    <clip pos="3" side="tl" part="lem"/>
	    <clip pos="3" side="tl" part="a_verb"/>                  
	    <lit-tag v="inf"/>                  
	    <clip pos="3" side="tl" part="lemq"/>                  
	  </lu>  
	</out>  
      </action>
   </rule>


   <rule>
   REGLA: Passé composé/perifràstic -->
<!-- Per traduir "ai fait" per "vaig fer" 
      <pattern>
	<pattern-item n="pascomp"/>
	<pattern-item n="adv"/>
	<pattern-item n="adv"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
	<out>
	  <lu>
	    <get-case-from pos="1">            
	      <lit v="anar"/>
	    </get-case-from>
	    <lit-tag v="vblex"/>
	    <clip pos="1" side="tl" part="temps"/>
	    <clip pos="1" side="tl" part="persona"/>
	    <clip pos="1" side="tl" part="nbr"/>
	  </lu>  
	   <b pos="1"/> 
	   <lu>
	   <clip pos="2" side="tl" part="whole"/>
	   </lu>  
	   <b pos="2"/> 
	   <lu>
	   <clip pos="3" side="tl" part="whole"/>
	   </lu>  
	   <b pos="3"/> 
	  <lu>  
	    <clip pos="4" side="tl" part="lem"/>
	    <clip pos="4" side="tl" part="a_verb"/>                  
	    <lit-tag v="inf"/>                  
	    <clip pos="4" side="tl" part="lemq"/>                  
	  </lu>  
	</out>  
      </action>
   </rule>-->  
   
   <rule>
<!-- REGLA:VBSER PP > haver + participi -->
      <pattern>
        <pattern-item n="vbser"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
      <choose>
       <when>
         <test>
	   <equal>
             <clip pos="1" side="sl" part="temps"/>           
	     <lit-tag v="pp"/>
           </equal>
	  </test>
            <out>
              <lu>
                <get-case-from pos="1">
                  <lit v="estar"/>
                </get-case-from>
                <lit-tag v="vblex"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
		<clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
	        <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
            </when>
	    <otherwise>
	      <out>
              <lu>
                <get-case-from pos="1">
                  <lit v="haver"/>
                </get-case-from>
                <lit-tag v="vbhaver"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
	        <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
	   </otherwise> 
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: PRN VBSER PP > haver + participi -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="vbser"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
      <!--  <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <list n="vbestat"/>
              </in>
            </test>-->
            <out>
              <lu>
                <get-case-from pos="1">
                  <lit v="haver"/>
                </get-case-from>
                <lit-tag v="vbhaver"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
       <!--    </when>
        </choose>-->
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN VERB (il arrive: arriba) -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="whole"/>
            </get-case-from>
          </lu>
        </out>
      </action>
    </rule>
    
    
    <rule>
<!--REGLA: PRN NE VERB PAS (il n'arrive pas: no arriba) -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="neadv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="whole"/>
            </get-case-from>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    
        <rule>
<!--REGLA: PRN VERB PRNENC -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="verb"/>
	<pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <mlu>
            <lu>
	      <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>     
	      </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prnenc"/>
              <clip pos="3" side="tl" part="persona"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
     
    <rule>
<!-- je m'appelle -> em dic -->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="appeler"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="persona"/>
                <clip pos="3" side="sl" part="persona"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="lem"/>
              <lit v="dir"/>
            </let>
          </when>
        </choose>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="whole"/>
            </get-case-from>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- je ne m'appelle pas -> no em dic -->
      <pattern>
        <pattern-item n="prnsubj"/>
	<pattern-item n="neadv"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="appeler"/>
	<pattern-item n="pas"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="persona"/>
                <clip pos="4" side="sl" part="persona"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="lem"/>
              <lit v="dir"/>
            </let>
          </when>
        </choose>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="whole"/>
            </get-case-from>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
	  <b pos="4"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    
    <rule>
<!--REGLA: PRN PRN VERB (il lui dit: li diu)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="prn"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_ifi1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="prn"/>
            <clip pos="2" side="tl" part="tipo_prn"/>
            <clip pos="2" side="tl" part="tipoenc_pro"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV VERB (il toujours arrive: sempre arriba)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV VERB PAS (il n'arrive pas: no arriba)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV VERB QUE (il ne mange que: no menja més que)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="neadv"/>
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV PRN VERB (il toujours lui dit: sempre li diu)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="prn"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_ifi1">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <lit-tag v="prn"/>
            <clip pos="3" side="tl" part="tipo_prn"/>
            <clip pos="3" side="tl" part="tipoenc_pro"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV PRN VERB PAS (il ne lui dit pas: no li diu)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="prn"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_ifi1">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV PRN VERB QUE (il ne lui dit que: no li diu més que)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="neadv"/>
        <pattern-item n="prn"/>
        <pattern-item n="verb"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_ifi1">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN PRN PRN VERB (il le lui dit: li'l diu)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="prn"/>
        <pattern-item n="prn"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_ifi1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_prn_prn">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="prn"/>
            <clip pos="2" side="tl" part="tipo_prn"/>
            <clip pos="2" side="tl" part="tipoenc_pro"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV PRN PRN VERB (il toujours le lui dit: sempre li ho diu)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="prn"/>
        <pattern-item n="prn"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_ifi1">
          <with-param pos="5"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: PRN ADV PRN PRN VERB PAS (il ne le lui dit pas: no li ho diu)-->
      <pattern>
        <pattern-item n="prnsubj"/>
        <pattern-item n="adv"/>
        <pattern-item n="prn"/>
        <pattern-item n="prn"/>
        <pattern-item n="verb"/>
        <pattern-item n="pas"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_ifi1">
          <with-param pos="5"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lem"/>
            </get-case-from>
            <lit-tag v="adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="whole"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="5" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: VERB (per a multiparaules sense enclítics)">
      <pattern>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: VERB-PRONOM(suis-je: sóc)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prnsubj"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: VERBSER-PRONOM(suis-je: sóc)-->
      <pattern>
        <pattern-item n="vbser"/>
        <pattern-item n="prnsubj"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
  <!--      <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <list n="vbestat"/>
              </in>
            </test>-->
            <out>
              <lu>
                <lit v="haver"/>
                <lit-tag v="vbhaver"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
      <!--     </when>
        </choose>-->
      </action>
    </rule>
    
    <rule>
<!--REGLA: VERB-t-PRONOM(a-t-elle: ha)-->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="nom"/>
        <pattern-item n="prnsubj"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: VERB + ENCLÍTIC -->
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <mlu>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prnenc"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
<!--
<rule> REGLA: VERB + ENCLÍTIC + ENCLÍTIC
      <pattern>
	<pattern-item n="verb"/>
	<pattern-item n="prnenc"/>
	<pattern-item n="prnenc"/>
    </pattern>
    <action>
      <out>
	<mlu>
	  <lu>
	    <clip pos="1" side="tl" part="lemh"/>
	    <clip pos="1" side="tl" part="a_verb"/>
	    <clip pos="1" side="tl" part="temps"/>
	    <clip pos="1" side="tl" part="persona"/>
	    <clip pos="1" side="tl" part="nbr"/>
	  </lu>
	  <lu>
	    <clip pos="2" side="tl" part="lem"/>
	    <clip pos="2" side="tl" part="a_prnenc"/>
	    <clip pos="2" side="tl" part="persona"/>
	    <clip pos="2" side="tl" part="gen"/>
	    <clip pos="2" side="tl" part="nbr"/>
	  </lu>
	  <lu>
	    <clip pos="3" side="tl" part="lem"/>
	    <clip pos="3" side="tl" part="a_prnenc"/>
	    <clip pos="3" side="tl" part="persona"/>
	    <clip pos="3" side="tl" part="gen"/>
	    <clip pos="3" side="tl" part="nbr"/>
	    <clip pos="1" side="tl" part="lemq"/>
	  </lu>    
	</mlu>
      </out>
    </action>
</rule>
-->
    <rule>
<!--REGLA:  être en train de= estar ger -->
      <pattern>
        <pattern-item n="vbser"/>
        <pattern-item n="enprep"/>
        <pattern-item n="train"/>
        <pattern-item n="deprep"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="estar"/>
            </get-case-from>
            <lit-tag v="vblex"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="5" side="tl" part="lemh"/>
            <clip pos="5" side="tl" part="a_verb"/>
            <lit-tag v="ger"/>
            <clip pos="5" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: prep "en" + ger = ger  : "en chantant -> cantant -->
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_ger"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>
    
    <rule>
<!--REGLA:  "en" + pro +ger= ger+enc -->
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="prnproobj"/>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <mlu>
            <lu>
              <get-case-from pos="1">
                <clip pos="3" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="3" side="tl" part="a_ger"/>
            </lu>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <lit-tag v="prn.enc"/>
              <clip pos="2" side="tl" part="tipoenc_pro"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA:  pro +ger = ger+enc -->
      <pattern>
        <pattern-item n="prnproobj"/>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <mlu>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_ger"/>
            </lu>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <lit-tag v="prn.enc"/>
              <clip pos="1" side="tl" part="tipoenc_pro"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
    
    <rule>

<!--REGLA:  pro +inf = inf+pro -->
      <pattern>
        <pattern-item n="prnproobj"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <mlu>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_inf"/>
            </lu>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <lit-tag v="prn.enc"/>
              <clip pos="1" side="tl" part="tipoenc_pro"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA:  à lui +inf = inf+pro (à lui dire > a dir-li) -->
      <pattern>
        <pattern-item n="a_lui"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="a"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <mlu>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_inf"/>
            </lu>
            <lu>
              <lit v="li"/>
              <lit-tag v="prn.enc.p3.mf.sg"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA:  à nous +inf = inf+pro (à nous aider > a ajudar-nos) -->
      <pattern>
        <pattern-item n="a_nous"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="a"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <mlu>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_inf"/>
            </lu>
            <lu>
              <lit v="ens"/>
              <lit-tag v="prn.enc.p1.mf.pl"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA:  à vous +inf = inf+pro (à vous aider > a ajudar-vos) -->
      <pattern>
        <pattern-item n="a_vous"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="a"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <mlu>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_inf"/>
            </lu>
            <lu>
              <lit v="us"/>
              <lit-tag v="prn.enc.p2.mf.pl"/>
            </lu>
          </mlu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- Verbs pronominals en francès i no pronominals en català. Los pronombres enclíticos (pospuestos) se eliminan a través del diccionario catalán -->
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="verbospron"/>
      </pattern>
      <action>
        <choose>
<!--Si la persona del pronombre y el verbo concuerdan, no envíes el pronombre -->
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="1" side="sl" part="persona"/>
                  <clip pos="2" side="sl" part="persona"/>
                </equal>
                <and>
                  <equal>
<!--Trampeta: perquè de vegades el tagger s'equivoca amb el gènere de "caía" (p1 o p3) -->
                    <clip pos="1" side="sl" part="persona"/>
                    <lit-tag v="p3"/>
                  </equal>
                  <equal>
                    <clip pos="2" side="sl" part="persona"/>
                    <lit-tag v="p1"/>
                  </equal>
                </and>
              </or>
            </test>
            <call-macro n="f_bcond">
<!--Envía el blanco sólo si tiene formato -->
              <with-param pos="1"/>
              <with-param pos="2"/>
            </call-macro>
          </when>
          <otherwise>
<!--Si no concuerdan el pronombre y el verbo, envíalo todo -->
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- Verbs pronominals en francés i no pronominals en català. Temps compostos-->
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="pascomp"/>
        <pattern-item n="verbospron_pp"/>
      </pattern>
      <action>
        <choose>
          <when>
<!--Si la persona del pronombre y el verbo concuerdan, no envíes el pronombre -->
            <test>
              <or>
                <equal>
                  <clip pos="1" side="sl" part="persona"/>
                  <clip pos="2" side="sl" part="persona"/>
                </equal>
                <and>
                  <equal>
<!--Trampeta: perquè de vegades el tagger s'equivoca amb el gènere de "había" (p1 o p3) -->
                    <clip pos="1" side="sl" part="persona"/>
                    <lit-tag v="p3"/>
                  </equal>
                  <equal>
                    <clip pos="2" side="sl" part="persona"/>
                    <lit-tag v="p1"/>
                  </equal>
                </and>
              </or>
            </test>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
              <with-param pos="2"/>
            </call-macro>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <lit-tag v="vaux"/>
<!--Para que traduzca "haber" como auxiliar (lo mismo que hace la regla HABER 3ª persona -->
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </when>
          <otherwise>
<!--Si no concuerdan el pronombre y el verbo, envíalo todo -->
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
            </out>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <lit-tag v="vaux"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!--REGLA: prep "en" + nploc = a + nploc: en France -> a França -->
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="nploc"/>
      </pattern>
      <action>
        <out>
          <lu>
            <get-case-from pos="1">
              <lit v="a"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: le + nploc (pays) = nploc: la France -> França -->
      <pattern>
        <pattern-item n="le"/>
        <pattern-item n="nploc"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal> <!-- en el cas de np.loc cal no cridar la macro -->
                <clip pos="2" side="tl" part="a_nploc"/>
                <lit-tag v="np.top"/>
              </equal>
            </test>
            <call-macro n="f_concord2">
              <with-param pos="2"/>
              <with-param pos="1"/>
            </call-macro>
          </when>
          <otherwise>
            <call-macro n="f_concord1">
              <with-param pos="1"/>
            </call-macro>
          </otherwise>
        </choose>

        <choose>
          <when>
            <test>
              <in>
                <clip pos="2" side="sl" part="lem"/>
                <list n="pays"/>
              </in>
            </test>
            <out>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!--REGLA: pas de: -->
      <pattern>
        <pattern-item n="pas"/>
        <pattern-item n="deprep"/>
      </pattern>
      <action>
 </action>
    </rule>
    
    <rule>
<!--REGLA: en 1998: l'any 1998 -->
      <pattern>
        <pattern-item n="enprep"/>
        <pattern-item n="xifra"/>
      </pattern>
      <action>
        <out>
          <lu>
            <lit v="el"/>
            <lit-tag v="det.def.m.sg"/>
          </lu>
          <b/>
          <lu>
            <lit v="any"/>
            <lit-tag v="n.m.sg"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: autant/moins/plus de NOM que de: tants/menys/més NOM com/que-->
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="nom"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="autant"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="tant"/>
                <lit-tag v="adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="com"/>
                <lit-tag v="rel.adv"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: autant/moins/plus de NOM que: tants/menys/més NOM com/que-->
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="nom"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="autant"/>
              </equal>
            </test>
	  <choose>  
	    <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </test>
 	    <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
 	      <b pos="3"/>
              <lu>
                <lit v="com"/>
                <lit-tag v="rel.adv"/>
              </lu>
	     </out> 
	   </when>
	   <otherwise>
            <out>
              <lu>
                <lit v="tant"/>
                <lit-tag v="adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="com"/>
                <lit-tag v="rel.adv"/>
              </lu>
            </out>
	  </otherwise>
	  </choose>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="tags"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: autant/menys/més de ADJ que de: tants/menys/més ADJ com/que-->
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="adj"/>
        <pattern-item n="que"/>
        <pattern-item n="deprep"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="autant"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="tant"/>
                <lit-tag v="adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="com"/>
                <lit-tag v="rel.adv"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: autant/menys/més de ADJ que: tants/menys/més ADJ com/que-->
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="deprep"/>
        <pattern-item n="adj"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="autant"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="tant"/>
                <lit-tag v="adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="com"/>
                <lit-tag v="rel.adv"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: aussi ADJ que: tan ADJ com -->
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adj"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="aussi"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="tan"/>
                <lit-tag v="preadv"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="com"/>
                <lit-tag v="rel.adv"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: aussi ADV que: aussi ADJ com -->
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="aussi"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="tan"/>
                <lit-tag v="preadv"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <lit v="com"/>
                <lit-tag v="rel.adv"/>
              </lu>
            </out>
          </when>
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule>
<!--REGLA: défense de fumer > prohibit fumar -->
      <pattern>
        <pattern-item n="defense"/>
        <pattern-item n="deprep"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <lu>
            <lit v="prohibir"/>
            <lit-tag v="vblex.pp.m.sg"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: ne pas fumer > no fumar, ne pas le dire > no dir-ho -->
      <pattern>
        <pattern-item n="neadv"/>
        <pattern-item n="pas"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: ne mange pas > no menja -->
      <pattern>
        <pattern-item n="neadv"/>
        <pattern-item n="verbconj"/>
        <pattern-item n="pas"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!--REGLA: on ne mange pas > no es menja -->
      <pattern>
        <pattern-item n="on"/>
        <pattern-item n="neadv"/>
        <pattern-item n="verbconj"/>
        <pattern-item n="pas"/>
      </pattern>
      <action>
        <call-macro n="f_ifi1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="tags"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <get-case-from pos="2">
              <clip pos="1" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>
<!-- REGLA: reset variables-->
      <pattern>
        <pattern-item n="sent"/>
      </pattern>
      <action>
        <let>
          <var n="numero"/>
          <lit-tag v="sg"/>
        </let>
        <let>
          <var n="genero"/>
          <lit-tag v="m"/>
        </let>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
  </section-rules>
  
</transfer>
